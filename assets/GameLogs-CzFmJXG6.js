import{g as J}from"./game-xj33TST8.js";import{e as T,P as B,o as L,v as x,E as t,D as s,F as l,Y as O,Z as p,$ as y,K as k,J as m,Q as V,w as i,G as v,W as E,a1 as F,r as c,a0 as w,h as n,s as D}from"./index-BsKuKuBe.js";import{N as G}from"./Select-CCDzjsmj.js";import{N as M}from"./DataTable-D5mRR0cm.js";import{N as A}from"./Divider-DILe50Hg.js";import{N as b}from"./Tag-I3_cH6qL.js";import"./Popover-CfBNgOAF.js";import"./use-compitable-BjMNwQgq.js";import"./create-Bj8PAPmY.js";import"./Empty-DtuLCoXR.js";import"./Radio-C5fS5KPL.js";import"./RadioGroup-CgIVku-C.js";import"./Tooltip-XZFA5Owl.js";import"./Dropdown-CcmdnIk3.js";import"./Icon-CbayTH31.js";import"./use-keyboard-kkRvbDTj.js";import"./create-ref-setter-C4J8sofl.js";import"./Pagination-BLbp2o8H.js";import"./Forward-CBwL8ab_.js";const K={class:"p-6"},Q={key:0},R={class:"mb-4 grid grid-cols-2 gap-2 text-sm"},W={class:"bg-gray-100 p-4 rounded text-xs font-mono overflow-auto max-h-[400px]"},ve=T({__name:"GameLogs",setup(Y){const h=B(),g=c(!1),N=c([]),_=c(!1),d=c(null),r=w({player_id:"",provider:null,game_name:"",round_id:""}),u=w({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[10,20,50]}),I=[{label:"PG Soft",value:"PG"},{label:"JILI",value:"JILI"},{label:"Evolution",value:"EVOLUTION"},{label:"Pragmatic Play",value:"PP"},{label:"JDB",value:"JDB"}],P=e=>{try{return JSON.stringify(JSON.parse(e),null,2)}catch{return e}},S=e=>{d.value=e,_.value=!0},z=[{title:"UID",key:"id",width:100,ellipsis:!0},{title:"時間",key:"settle_time",width:160,render:e=>e.settle_time.replace("T"," ").slice(5,16)},{title:"玩家",key:"player_id",width:100},{title:"遊戲",key:"game_name",width:200,render:e=>n("div",[n(b,{size:"small",class:"mr-1"},{default:()=>e.provider_id}),n("span",e.game_name)])},{title:"投注",key:"bet_amount",align:"right",render:e=>e.bet_amount},{title:"中獎",key:"win_amount",align:"right",render:e=>e.win_amount},{title:"輸贏",key:"net_amount",align:"right",render:e=>{const a=e.net_amount>=0?"text-green-600":"text-red-600",o=e.net_amount>0?"+":"";return n("span",{class:["font-bold",a]},o+e.net_amount)}},{title:"有效流水",key:"valid_turnover",align:"right",render:e=>e.status==="void"?n("span",{class:"text-gray-400 line-through"},e.valid_turnover):e.valid_turnover},{title:"狀態",key:"status",width:80,render:e=>e.status==="void"?n(b,{type:"error",size:"small",bordered:!1},{default:()=>"註銷"}):n(b,{type:"success",size:"small",bordered:!1},{default:()=>"結算"})},{title:"操作",key:"action",width:80,render:e=>n(k,{size:"tiny",onClick:()=>S(e)},{default:()=>"詳情"})}],f=async()=>{g.value=!0;try{const e={page:u.page,page_size:u.pageSize,player_id:r.player_id||void 0,provider:r.provider||void 0,game_name:r.game_name||void 0,round_id:r.round_id||void 0},a=await J.getLogs(e);a.code===0?(N.value=a.data.list,u.itemCount=a.data.total):h.error(a.msg)}catch{h.error("載入失敗")}finally{g.value=!1}},C=()=>{u.page=1,f()},U=e=>{u.page=e,f()};return L(()=>{f()}),(e,a)=>(D(),x("div",K,[t(l(V),{title:"遊戲對局紀錄"},{default:s(()=>[t(l(O),{inline:"","label-placement":"left",class:"mb-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},{default:s(()=>[t(l(p),{label:"玩家 ID"},{default:s(()=>[t(l(y),{value:r.player_id,"onUpdate:value":a[0]||(a[0]=o=>r.player_id=o),placeholder:"ID / 帳號",clearable:""},null,8,["value"])]),_:1}),t(l(p),{label:"供應商"},{default:s(()=>[t(l(G),{value:r.provider,"onUpdate:value":a[1]||(a[1]=o=>r.provider=o),options:I,placeholder:"全部",clearable:"",style:{width:"140px"}},null,8,["value"])]),_:1}),t(l(p),{label:"遊戲名稱"},{default:s(()=>[t(l(y),{value:r.game_name,"onUpdate:value":a[2]||(a[2]=o=>r.game_name=o),placeholder:"模糊搜尋",clearable:""},null,8,["value"])]),_:1}),t(l(p),{label:"局號"},{default:s(()=>[t(l(y),{value:r.round_id,"onUpdate:value":a[3]||(a[3]=o=>r.round_id=o),placeholder:"供應商局號",clearable:""},null,8,["value"])]),_:1}),t(l(p),{class:"col-span-2"},{default:s(()=>[t(l(k),{type:"primary",onClick:C,loading:g.value},{default:s(()=>[...a[5]||(a[5]=[m("查詢",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),t(l(M),{columns:z,data:N.value,loading:g.value,pagination:u,"onUpdate:page":U},null,8,["data","loading","pagination"])]),_:1}),t(l(F),{show:_.value,"onUpdate:show":a[4]||(a[4]=o=>_.value=o),preset:"card",title:"對局詳情 (原始數據)",style:{width:"600px"}},{default:s(()=>[d.value?(D(),x("div",Q,[i("div",R,[i("div",null,[a[6]||(a[6]=i("span",{class:"text-gray-500"},"UID:",-1)),m(" "+v(d.value.id),1)]),i("div",null,[a[7]||(a[7]=i("span",{class:"text-gray-500"},"Provider:",-1)),m(" "+v(d.value.provider_id),1)]),i("div",null,[a[8]||(a[8]=i("span",{class:"text-gray-500"},"Round ID:",-1)),m(" "+v(d.value.provider_round_id),1)]),i("div",null,[a[9]||(a[9]=i("span",{class:"text-gray-500"},"Settle Time:",-1)),m(" "+v(d.value.settle_time.replace("T"," ").split(".")[0]),1)])]),t(l(A)),i("pre",W,v(P(d.value.raw_json)),1)])):E("",!0)]),_:1},8,["show"])]))}});export{ve as default};
