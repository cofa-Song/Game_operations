import{m as C}from"./assetLogs-Dslkok5U.js";import{e as E,P as L,o as k,v as x,E as r,D as u,F as i,Y as T,Z as m,$ as D,K as O,J as z,Q as S,r as v,a0 as b,h as o,s as U}from"./index-BsKuKuBe.js";import{N as h}from"./Select-CCDzjsmj.js";import{N as A}from"./DataTable-D5mRR0cm.js";import{N}from"./Tag-I3_cH6qL.js";import"./Popover-CfBNgOAF.js";import"./use-compitable-BjMNwQgq.js";import"./create-Bj8PAPmY.js";import"./Empty-DtuLCoXR.js";import"./Radio-C5fS5KPL.js";import"./RadioGroup-CgIVku-C.js";import"./Tooltip-XZFA5Owl.js";import"./Dropdown-CcmdnIk3.js";import"./Icon-CbayTH31.js";import"./use-keyboard-kkRvbDTj.js";import"./create-ref-setter-C4J8sofl.js";import"./Pagination-BLbp2o8H.js";import"./Forward-CBwL8ab_.js";const B=a=>new Promise(l=>setTimeout(l,a)),w={getLogs:async a=>{await B(300);let l=[...C];if(a.player_id&&(l=l.filter(s=>s.player_id.includes(a.player_id)||s.username.includes(a.player_id))),a.currency&&(l=l.filter(s=>s.currency===a.currency)),a.change_type&&(l=l.filter(s=>s.change_type===a.change_type)),a.date_start&&a.date_end){const s=new Date(a.date_start).getTime(),_=new Date(a.date_end).getTime();l=l.filter(f=>{const d=new Date(f.timestamp).getTime();return d>=s&&d<=_})}const p=l.length,g=(a.page-1)*a.page_size,n=g+a.page_size;return{code:0,msg:"success",data:{list:l.slice(g,n),total:p}}}},W={class:"p-6"},le=E({__name:"AssetLogs",setup(a){const l=L(),p=v(!1),g=v([]),n=b({player_id:"",currency:null,change_type:null}),c=b({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[10,20,50]}),s=[{label:"金幣 (Gold)",value:"GOLD"},{label:"銀幣 (Silver)",value:"SILVER"},{label:"銅幣 (Bronze)",value:"BRONZE"}],_=[{label:"投注 (BET)",value:"BET"},{label:"派彩 (WIN)",value:"WIN"},{label:"領取 (CLAIM)",value:"CLAIM"},{label:"解鎖 (UNLOCK)",value:"UNLOCK"},{label:"清零 (WIPE)",value:"WIPE"},{label:"互換 (EXCHANGE)",value:"EXCHANGE"},{label:"P2P 轉出",value:"P2P_OUT"},{label:"P2P 轉入",value:"P2P_IN"}],f=[{title:"Log ID",key:"log_id",width:150,ellipsis:!0},{title:"時間",key:"timestamp",width:180,render:e=>e.timestamp.replace("T"," ").split(".")[0]},{title:"玩家",key:"username",render:e=>o("div",[o("div",{class:"font-bold"},e.username),o("div",{class:"text-xs text-gray-500"},e.player_id)])},{title:"幣別/錢包",key:"currency",render:e=>o("div",[o(N,{size:"small",type:e.currency==="GOLD"?"warning":e.currency==="SILVER"?"info":"default",class:"mr-1"},{default:()=>e.currency}),o("span",{class:"text-xs"},e.wallet_type)])},{title:"類型",key:"change_type",render:e=>{let t="default";return["WIN","CLAIM","UNLOCK","P2P_IN"].includes(e.change_type)&&(t="success"),["BET","WIPE","P2P_OUT"].includes(e.change_type)&&(t="error"),o(N,{type:t,bordered:!1},{default:()=>e.change_type})}},{title:"變動金額",key:"amount",align:"right",render:e=>{const t=e.amount>0;return o("span",{class:t?"text-green-600 font-bold":"text-red-600 font-bold"},(t?"+":"")+e.amount)}},{title:"變更後餘額",key:"post_balance",align:"right"},{title:"有效流水",key:"valid_turnover",align:"right",render:e=>e.valid_turnover>0?o("span",{class:"text-blue-600 font-bold"},e.valid_turnover):"-"},{title:"關聯單號",key:"related_id",ellipsis:!0}],d=async()=>{p.value=!0;try{const e={page:c.page,page_size:c.pageSize,player_id:n.player_id||void 0,currency:n.currency||void 0,change_type:n.change_type||void 0},t=await w.getLogs(e);t.code===0?(g.value=t.data.list,c.itemCount=t.data.total):l.error(t.msg)}catch{l.error("載入失敗")}finally{p.value=!1}},P=()=>{c.page=1,d()},I=e=>{c.page=e,d()};return k(()=>{d()}),(e,t)=>(U(),x("div",W,[r(i(S),{title:"資產與流水變動日誌"},{default:u(()=>[r(i(T),{inline:"","label-placement":"left",class:"mb-4"},{default:u(()=>[r(i(m),{label:"玩家 ID"},{default:u(()=>[r(i(D),{value:n.player_id,"onUpdate:value":t[0]||(t[0]=y=>n.player_id=y),placeholder:"ID / 帳號",clearable:""},null,8,["value"])]),_:1}),r(i(m),{label:"幣別"},{default:u(()=>[r(i(h),{value:n.currency,"onUpdate:value":t[1]||(t[1]=y=>n.currency=y),options:s,placeholder:"全部",clearable:"",style:{width:"120px"}},null,8,["value"])]),_:1}),r(i(m),{label:"變動類型"},{default:u(()=>[r(i(h),{value:n.change_type,"onUpdate:value":t[2]||(t[2]=y=>n.change_type=y),options:_,placeholder:"全部",clearable:"",style:{width:"150px"}},null,8,["value"])]),_:1}),r(i(m),null,{default:u(()=>[r(i(O),{type:"primary",onClick:P},{default:u(()=>[...t[3]||(t[3]=[z("查詢",-1)])]),_:1})]),_:1})]),_:1}),r(i(A),{columns:f,data:g.value,loading:p.value,pagination:c,"onUpdate:page":I},null,8,["data","loading","pagination"])]),_:1})]))}});export{le as default};
