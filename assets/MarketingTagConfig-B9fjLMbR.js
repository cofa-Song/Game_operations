import{c as h}from"./config-DZ_tPtnd.js";import{e as S,A as V,P as U,h as u,K as d,o as B,v as O,E as o,D as s,F as e,J as c,G as k,Q as z,Y as $,Z as T,$ as N,C as F,W as Y,w as q,a1 as P,r as p,s as _}from"./index-BsKuKuBe.js";import{C as R}from"./CreateOutline-CbXbgX50.js";import{T as j}from"./TrashOutline-A99Fg1Y4.js";import{R as G}from"./RefreshOutline-DGpX8rVm.js";import{A as J}from"./AddOutline-DAXbjVCv.js";import{u as K}from"./composables-FnfCle_S.js";import{N as w}from"./Tag-I3_cH6qL.js";import{N as L}from"./DataTable-D5mRR0cm.js";import{N as C}from"./Space-Cf9Hs1lp.js";import{N as Q}from"./Switch-DXNn_bI_.js";import{N as W}from"./InputNumber-BMu_ZOnr.js";import{N as Z}from"./Select-CCDzjsmj.js";import"./Radio-C5fS5KPL.js";import"./RadioGroup-CgIVku-C.js";import"./Tooltip-XZFA5Owl.js";import"./Popover-CfBNgOAF.js";import"./use-compitable-BjMNwQgq.js";import"./Dropdown-CcmdnIk3.js";import"./Icon-CbayTH31.js";import"./create-Bj8PAPmY.js";import"./use-keyboard-kkRvbDTj.js";import"./create-ref-setter-C4J8sofl.js";import"./Empty-DtuLCoXR.js";import"./Pagination-BLbp2o8H.js";import"./Forward-CBwL8ab_.js";import"./Add-BJRbFrfV.js";const H={class:"p-6"},X={class:"flex justify-end gap-2"},De=S({__name:"MarketingTagConfig",setup(ee){const{t}=V(),i=U(),M=K(),f=p(!1),b=p([]),m=p(!1),v=p(!1),g=p(null),r=p({name:"",has_rate:!0,rate:100,status:"ACTIVE",description:""}),x=[{title:"ID",key:"id",width:80},{title:t("game.list.tag"),key:"name",width:120},{title:t("game.provider.type"),key:"tag_type",width:100,render:a=>u(w,{size:"small",bordered:!1,type:a.tag_type==="SYSTEM"?"info":"success"},{default:()=>a.tag_type==="SYSTEM"?"系統":"自定義"})},{title:t("game.config.rate"),key:"rate",width:120,render:a=>a.has_rate?u("span",{class:"font-mono font-semibold"},`${a.rate}%`):u("span",{class:"text-gray-400"},"不調整")},{title:t("common.status"),key:"status",width:100,render:a=>u(w,{size:"small",type:a.status==="ACTIVE"?"success":"error"},{default:()=>a.status==="ACTIVE"?t("common.enable"):t("common.disable")})},{title:t("permission.groupManagement.groupDesc"),key:"description",width:200,ellipsis:{tooltip:!0}},{title:"使用中遊戲",key:"games_using",width:100},{title:t("common.action"),key:"actions",width:140,fixed:"right",render:a=>u("div",{class:"flex gap-1"},[u(d,{size:"small",secondary:!0,onClick:()=>E(a)},{icon:()=>u(R),default:()=>t("common.edit")}),a.tag_type==="CUSTOM"?u(d,{size:"small",type:"error",secondary:!0,onClick:()=>I(a)},{icon:()=>u(j)}):null])}],y=async()=>{f.value=!0;try{const a=await h.getMarketingTags();a.code===0?b.value=a.data:i.error(a.msg)}catch{i.error(t("common.error"))}finally{f.value=!1}},D=()=>{v.value=!1,g.value=null,r.value={name:"",has_rate:!0,rate:100,status:"ACTIVE",description:""},m.value=!0},E=a=>{v.value=!0,g.value=a.id,r.value={name:a.name,has_rate:a.has_rate,rate:a.rate,status:a.status,description:a.description},m.value=!0},I=a=>{if(a.games_using>0){i.error("該標籤尚有遊戲正在使用中，無法刪除");return}M.warning({title:t("common.delete"),content:`確定要刪除標籤「${a.name}」嗎？`,positiveText:t("common.confirm"),negativeText:t("common.cancel"),onPositiveClick:async()=>{try{const l=await h.deleteMarketingTag(a.id);l.code===0?(i.success(t("common.success")),y()):i.error(l.msg)}catch{i.error(t("common.error"))}}})},A=async()=>{if(!r.value.name){i.warning("請輸入標籤名稱");return}try{let a;v.value&&g.value?a=await h.updateMarketingTag(g.value,r.value):a=await h.createMarketingTag(r.value),a.code===0?(i.success(t("common.success")),m.value=!1,y()):i.error(a.msg)}catch{i.error(t("common.error"))}};return B(()=>{y()}),(a,l)=>(_(),O("div",H,[o(e(z),{title:e(t)("game.config.tagTitle")},{"header-extra":s(()=>[o(e(C),null,{default:s(()=>[o(e(d),{secondary:"",onClick:y,loading:f.value},{icon:s(()=>[o(e(G))]),default:s(()=>[c(" "+k(e(t)("common.search")),1)]),_:1},8,["loading"]),o(e(d),{type:"primary",onClick:D},{icon:s(()=>[o(e(J))]),default:s(()=>[c(" "+k(e(t)("common.add")),1)]),_:1})]),_:1})]),default:s(()=>[o(e(L),{columns:x,data:b.value,loading:f.value,pagination:!1,bordered:!1},null,8,["data","loading"])]),_:1},8,["title"]),o(e(P),{show:m.value,"onUpdate:show":l[6]||(l[6]=n=>m.value=n),preset:"card",title:v.value?e(t)("common.edit"):e(t)("common.add"),style:{width:"500px"}},{footer:s(()=>[q("div",X,[o(e(d),{onClick:l[5]||(l[5]=n=>m.value=!1)},{default:s(()=>[c(k(e(t)("common.cancel")),1)]),_:1}),o(e(d),{type:"primary",onClick:A},{default:s(()=>[c(k(e(t)("common.save")),1)]),_:1})])]),default:s(()=>[o(e($),{model:r.value,"label-placement":"left","label-width":"100"},{default:s(()=>[o(e(T),{label:e(t)("game.list.tag"),required:""},{default:s(()=>[o(e(N),{value:r.value.name,"onUpdate:value":l[0]||(l[0]=n=>r.value.name=n),placeholder:e(t)("game.list.tag")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(e(T),{label:e(t)("game.config.rate")},{default:s(()=>[o(e(C),{vertical:"",class:"w-full"},{default:s(()=>[o(e(Q),{value:r.value.has_rate,"onUpdate:value":l[1]||(l[1]=n=>r.value.has_rate=n)},{checked:s(()=>[...l[7]||(l[7]=[c("開啟比例設定",-1)])]),unchecked:s(()=>[...l[8]||(l[8]=[c("不調整比例",-1)])]),_:1},8,["value"]),r.value.has_rate?(_(),F(e(W),{key:0,value:r.value.rate,"onUpdate:value":l[2]||(l[2]=n=>r.value.rate=n),min:0,max:1e3,step:5,style:{width:"100%"},suffix:"%"},null,8,["value"])):Y("",!0)]),_:1})]),_:1},8,["label"]),o(e(T),{label:e(t)("common.status"),required:""},{default:s(()=>[o(e(Z),{value:r.value.status,"onUpdate:value":l[3]||(l[3]=n=>r.value.status=n),options:[{label:e(t)("common.enable"),value:"ACTIVE"},{label:e(t)("common.disable"),value:"DISABLED"}]},null,8,["value","options"])]),_:1},8,["label"]),o(e(T),{label:e(t)("permission.groupManagement.groupDesc")},{default:s(()=>[o(e(N),{type:"textarea",value:r.value.description,"onUpdate:value":l[4]||(l[4]=n=>r.value.description=n),placeholder:e(t)("permission.groupManagement.groupDesc"),rows:3},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["show","title"])]))}});export{De as default};
