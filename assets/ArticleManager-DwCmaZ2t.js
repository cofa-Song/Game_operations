import{e as te,B as ge,o as ae,aS as ve,v as Z,w as le,s as G,r as h,_ as ie,A as _e,P as he,E as l,D as i,F as a,K as N,J as C,G as E,W as ye,Q as K,Y as Q,Z as v,T as X,U as M,$ as V,a0 as $,h as m,j as be}from"./index-BsKuKuBe.js";import{C as we}from"./CreateOutline-CbXbgX50.js";import{T as Se}from"./TrashOutline-A99Fg1Y4.js";import{u as Ne}from"./composables-FnfCle_S.js";import{N as L}from"./Space-Cf9Hs1lp.js";import{N as W}from"./Select-CCDzjsmj.js";import{N as j}from"./DatePicker-CVYfnur-.js";import{N as Te}from"./DataTable-D5mRR0cm.js";import{N as xe,a as Ce}from"./DrawerContent-Dys-I5Rb.js";import{N as Oe}from"./Upload-BfkJi9Os.js";import{N as ke,a as B}from"./Tabs-CMKBZqEE.js";import{N as De}from"./Tag-I3_cH6qL.js";import{N as Ie}from"./Avatar-B3QGANDM.js";import{N as q}from"./Switch-DXNn_bI_.js";import{N as ee}from"./Icon-CbayTH31.js";import"./Popover-CfBNgOAF.js";import"./use-compitable-BjMNwQgq.js";import"./create-Bj8PAPmY.js";import"./Empty-DtuLCoXR.js";import"./use-keyboard-kkRvbDTj.js";import"./Forward-CBwL8ab_.js";import"./Radio-C5fS5KPL.js";import"./RadioGroup-CgIVku-C.js";import"./Tooltip-XZFA5Owl.js";import"./Dropdown-CcmdnIk3.js";import"./create-ref-setter-C4J8sofl.js";import"./Pagination-BLbp2o8H.js";import"./Progress-DbyywU95.js";import"./Image--btsxYxc.js";import"./utils-pxpSiB-j.js";import"./Add-BJRbFrfV.js";import"./toNumber-By67wpTM.js";const _=[{id:"ART001",category:"PROMOTION",title:"春節限時儲值加碼 10% 贈送",language:"zh-TW",cover_url:"https://placehold.co/400x300?text=Promotion+Cover",content:"<h1>春節加碼</h1><p>活動時間：2026/02/01 - 2026/02/15</p>",last_modified_at:"2026-02-01T10:00:00Z",last_modified_by:"admin_sys",publish_start:"2026-02-01T00:00:00Z",publish_end:"2026-02-15T23:59:59Z",status_test:!0,status_live:!0,seo:{meta_title:"2026 春節儲值優惠 - 打火機娛樂",meta_keywords:"春節,儲值,加碼,優惠",meta_description:"春節限時儲值加碼 10%，最高贈送 88,888 點！"}},{id:"ART002",category:"ENCYCLOPEDIA",title:"老虎機新手入門：贏錢技巧大公開",language:"zh-TW",cover_url:"https://placehold.co/400x300?text=Slot+Guide",content:"<h2>什麼是 RTP？</h2><p>RTP 代表玩家返還率...</p>",last_modified_at:"2026-01-15T14:30:00Z",last_modified_by:"content_editor",publish_start:"2026-01-20T00:00:00Z",status_test:!0,status_live:!1,seo:{}}],I=(o=400)=>new Promise(n=>setTimeout(n,o)),z={async list(o){await I();let n=[..._];if(o.categories&&o.categories.length>0&&(n=n.filter(y=>o.categories.includes(y.category))),o.start_time){const y=new Date(o.start_time).getTime();n=n.filter(O=>new Date(O.publish_start).getTime()>=y)}const u=o.page||1,p=o.pageSize||10,d=(u-1)*p;return{code:0,msg:"success",data:{items:n.slice(d,d+p),total:n.length,page:u,pageSize:p}}},async get(o){await I(100);const n=_.find(u=>u.id===o);return n?{code:0,msg:"success",data:n}:{code:404,msg:"Article not found"}},async save(o){if(await I(),o.id){const u=_.findIndex(p=>p.id===o.id);if(u!==-1)return _[u]={..._[u],...o,last_modified_at:new Date().toISOString(),last_modified_by:"admin"},{code:0,msg:"success",data:_[u]}}const n={...o,id:`ART${Math.floor(Math.random()*1e3).toString().padStart(3,"0")}`,last_modified_at:new Date().toISOString(),last_modified_by:"admin",status_test:o.status_test??!1,status_live:o.status_live??!1,seo:o.seo||{}};return _.unshift(n),{code:0,msg:"success",data:n}},async delete(o){await I();const n=_.findIndex(u=>u.id===o);return n!==-1&&_.splice(n,1),{code:0,msg:"success"}},async toggleStatus(o,n,u){await I(200);const p=_.findIndex(d=>d.id===o);return p!==-1&&(n==="test"?_[p].status_test=u:_[p].status_live=u),{code:0,msg:"success"}}},ze={class:"tinymce-editor"},Ue=te({__name:"TinymceEditor",props:{modelValue:{},placeholder:{},height:{}},emits:["update:modelValue"],setup(o,{emit:n}){const u=o,p=n,d=`tinymce-${Math.random().toString(36).substring(2,9)}`,b=h(null),y=c=>new Promise((f,S)=>{if(window.tinyMCE){f(!0);return}const g=document.createElement("script");g.src=c,g.referrerPolicy="origin",g.onload=f,g.onerror=S,document.head.appendChild(g)}),O=async()=>{await y("https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js"),window.tinymce&&window.tinymce.init({selector:`#${d}`,height:u.height||400,menubar:!1,plugins:["advlist","autolink","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","code","help","wordcount"],toolbar:"undo redo | blocks | bold italic forecolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }",placeholder:u.placeholder,setup:c=>{b.value=c,c.on("init",()=>{c.setContent(u.modelValue)}),c.on("change input undo redo",()=>{const f=c.getContent();p("update:modelValue",f)})}})};return ge(()=>u.modelValue,c=>{b.value&&c!==b.value.getContent()&&b.value.setContent(c)}),ae(()=>{O()}),ve(()=>{window.tinymce&&window.tinymce.remove(`#${d}`)}),(c,f)=>(G(),Z("div",ze,[le("textarea",{id:d})]))}}),Pe=ie(Ue,[["__scopeId","data-v-3dae4b26"]]),Ee={class:"article-manager"},Me={class:"flex gap-2"},Re={key:0,class:"ml-1"},Ae=te({__name:"ArticleManager",setup(o){const{t:n}=_e(),u=he(),p=Ne(),d=$({categories:[],start_time:void 0,end_time:void 0}),b=h(null),y=[{label:"優惠活動",value:"PROMOTION"},{label:"系統公告",value:"SYSTEM"},{label:"遊戲百科",value:"ENCYCLOPEDIA"},{label:"SEO 專欄",value:"SEO"},{label:"服務條款",value:"TERMS"}],O=[{label:"繁體中文 (zh-TW)",value:"zh-TW"},{label:"簡體中文 (zh-CN)",value:"zh-CN"},{label:"English (en)",value:"en"}],c=t=>t?new Date(t).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(/\//g,"-"):"-",f=h(!1),S=h([]),g=$({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[10,20,50]}),w=h([]),se=[{title:"文章類別",key:"category",render:t=>{const e=y.find(s=>s.value===t.category);return m(De,{type:"info",size:"small"},{default:()=>(e==null?void 0:e.label)||t.category})}},{title:"文章標題",key:"title",ellipsis:{tooltip:!0},width:200},{title:"封面",key:"cover_url",render:t=>m(Ie,{src:t.cover_url,size:"small",fallbackSrc:"https://placehold.co/40x30"})},{title:"發佈區間",key:"publish_start",render:t=>m("div",{style:"font-size: 12px"},[m("div",`起: ${c(t.publish_start)}`),m("div",`止: ${t.publish_end?c(t.publish_end):"永久上架"}`)])},{title:"操作人",key:"last_modified_by"},{title:"狀態 (測試)",key:"status_test",render:t=>m(q,{value:t.status_test,onUpdateValue:e=>J(t.id,"test",e)})},{title:"狀態 (正式)",key:"status_live",render:t=>m(q,{value:t.status_live,onUpdateValue:e=>J(t.id,"live",e)})},{title:"操作",key:"actions",render:t=>m(L,{},{default:()=>[m(N,{size:"tiny",onClick:()=>F(t.id)},{icon:()=>m(ee,null,{default:()=>m(we)})}),m(N,{size:"tiny",type:"error",onClick:()=>pe(t.id)},{icon:()=>m(ee,null,{default:()=>m(Se)})})]})}],T=async()=>{f.value=!0;try{const t=await z.list({...d,page:g.page,pageSize:g.pageSize});t.code===0&&t.data&&(S.value=t.data.items,g.itemCount=t.data.total)}finally{f.value=!1}},ne=()=>{g.page=1,T()},oe=t=>{g.page=t,T()},re=t=>{t?(d.start_time=new Date(t[0]).toISOString(),d.end_time=new Date(t[1]).toISOString()):(d.start_time=void 0,d.end_time=void 0)},k=h(!1),R=h(null),A=h(!1),Y=h(null),r=$({title:"",category:"PROMOTION",language:"zh-TW",cover_url:"",content:"",publish_start:"",publish_end:"",seo:{meta_title:"",meta_description:""}}),D=h(Date.now()),x=h(null),ue={title:{required:!0,message:"請輸入標題",trigger:"blur"},category:{required:!0,message:"請選擇類別",trigger:"change"},language:{required:!0,message:"請選擇語系",trigger:"change"}},de=be(()=>r.cover_url?[{id:"cover",name:"cover.png",status:"finished",url:r.cover_url}]:[]),ce=t=>{if(t.fileList.length>0){const e=t.fileList[0];e.file?r.cover_url=URL.createObjectURL(e.file):e.url&&(r.cover_url=e.url)}else r.cover_url=""},F=async t=>{if(R.value=t||null,t){const e=await z.get(t);e.code===0&&e.data&&(Object.assign(r,JSON.parse(JSON.stringify(e.data))),D.value=new Date(e.data.publish_start).getTime(),x.value=e.data.publish_end?new Date(e.data.publish_end).getTime():null)}else Object.assign(r,{title:"",category:"PROMOTION",language:"zh-TW",cover_url:"",content:"",publish_start:new Date().toISOString(),publish_end:"",seo:{meta_title:"",meta_description:""}}),D.value=Date.now(),x.value=null;k.value=!0},me=async()=>{var t;(t=Y.value)==null||t.validate(async e=>{if(!e){A.value=!0;try{r.publish_start=new Date(D.value).toISOString(),r.publish_end=x.value?new Date(x.value).toISOString():"";const s={...r,id:R.value||void 0};(await z.save(s)).code===0&&(u.success("文章已儲存並發佈"),k.value=!1,T())}finally{A.value=!1}}})},pe=t=>{p.warning({title:"確認刪除",content:"確定要刪除這篇文章嗎？此操作不可恢復。",positiveText:"確認刪除",negativeText:"取消",onPositiveClick:async()=>{await z.delete(t),u.success("文章已刪除"),T()}})},J=(t,e,s)=>{const U=S.value.findIndex(P=>P.id===t);U!==-1&&(e==="test"?S.value[U].status_test=s:S.value[U].status_live=s);const H=w.value.findIndex(P=>P.id===t&&P.site===e);H!==-1?w.value.splice(H,1):w.value.push({id:t,site:e,status:s})},fe=async()=>{f.value=!0;try{for(const t of w.value)await z.toggleStatus(t.id,t.site,t.status);u.success("變更已套用"),w.value=[],T()}finally{f.value=!1}};return ae(()=>{T()}),(t,e)=>(G(),Z("div",Ee,[l(a(K),{title:a(n)("navigation.articleManagement"),class:"shadow-sm rounded-lg border-none"},{"header-extra":i(()=>[l(a(N),{type:"info",onClick:e[0]||(e[0]=s=>F())},{default:i(()=>[C(E(a(n)("common.add")),1)]),_:1})]),default:i(()=>[l(a(L),{vertical:"",size:"large"},{default:i(()=>[le("div",Me,[l(a(N),{type:"warning",disabled:w.value.length===0,onClick:fe,loading:f.value},{default:i(()=>[C(E(a(n)("game.list.accessOperation"))+" ",1),w.value.length?(G(),Z("span",Re,"("+E(w.value.length)+")",1)):ye("",!0)]),_:1},8,["disabled","loading"])]),l(a(K),{embedded:"",bordered:!1,size:"small"},{default:i(()=>[l(a(Q),{inline:"",model:d,"label-placement":"left"},{default:i(()=>[l(a(v),{label:a(n)("article.category")},{default:i(()=>[l(a(W),{value:d.categories,"onUpdate:value":e[1]||(e[1]=s=>d.categories=s),multiple:"",clearable:"",options:y,placeholder:"篩選類別",style:{width:"260px"}},null,8,["value"])]),_:1},8,["label"]),l(a(v),{label:a(n)("article.timeRange")},{default:i(()=>[l(a(j),{value:b.value,"onUpdate:value":[e[2]||(e[2]=s=>b.value=s),re],type:"datetimerange",clearable:""},null,8,["value"])]),_:1},8,["label"]),l(a(v),null,{default:i(()=>[l(a(N),{type:"primary",onClick:ne},{default:i(()=>[C(E(a(n)("common.search")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(a(Te),{remote:"",columns:se,data:S.value,loading:f.value,pagination:g,"onUpdate:page":oe},null,8,["data","loading","pagination"])]),_:1})]),_:1},8,["title"]),l(a(Ce),{show:k.value,"onUpdate:show":e[12]||(e[12]=s=>k.value=s),width:"850",placement:"right"},{default:i(()=>[l(a(xe),{title:R.value?"編輯文章":"新增文章",closable:""},{footer:i(()=>[l(a(L),{justify:"end"},{default:i(()=>[l(a(N),{onClick:e[11]||(e[11]=s=>k.value=!1)},{default:i(()=>[...e[14]||(e[14]=[C("取消",-1)])]),_:1}),l(a(N),{type:"primary",loading:A.value,onClick:me},{default:i(()=>[...e[15]||(e[15]=[C("提交發佈",-1)])]),_:1},8,["loading"])]),_:1})]),default:i(()=>[l(a(Q),{ref_key:"formRef",ref:Y,model:r,rules:ue,"label-placement":"top"},{default:i(()=>[l(a(X),{cols:2,"x-gap":20},{default:i(()=>[l(a(M),null,{default:i(()=>[l(a(v),{label:"文章語系",path:"language"},{default:i(()=>[l(a(W),{value:r.language,"onUpdate:value":e[3]||(e[3]=s=>r.language=s),options:O},null,8,["value"])]),_:1})]),_:1}),l(a(M),null,{default:i(()=>[l(a(v),{label:"文章類別",path:"category"},{default:i(()=>[l(a(W),{value:r.category,"onUpdate:value":e[4]||(e[4]=s=>r.category=s),options:y},null,8,["value"])]),_:1})]),_:1})]),_:1}),l(a(v),{label:"文章標題",path:"title"},{default:i(()=>[l(a(V),{value:r.title,"onUpdate:value":e[5]||(e[5]=s=>r.title=s),placeholder:"建議 30 字內","count-text-style":"true",maxlength:"50","show-count":""},null,8,["value"])]),_:1}),l(a(v),{label:"封面縮圖",path:"cover_url"},{default:i(()=>[l(a(Oe),{action:"#","list-type":"image-card",max:1,"default-file-list":de.value,onChange:ce},{default:i(()=>[...e[13]||(e[13]=[C(" 點擊上傳 ",-1)])]),_:1},8,["default-file-list"])]),_:1}),l(a(ke),{type:"line",animated:""},{default:i(()=>[l(a(B),{name:"content",tab:"內容編輯"},{default:i(()=>[l(a(v),{label:"富文本內容",path:"content","show-label":!1},{default:i(()=>[l(Pe,{modelValue:r.content,"onUpdate:modelValue":e[6]||(e[6]=s=>r.content=s),placeholder:"請輸入文章內容",height:500},null,8,["modelValue"])]),_:1})]),_:1}),l(a(B),{name:"seo",tab:"SEO 優化"},{default:i(()=>[l(a(v),{label:"Meta Title",path:"seo.meta_title"},{default:i(()=>[l(a(V),{value:r.seo.meta_title,"onUpdate:value":e[7]||(e[7]=s=>r.seo.meta_title=s),placeholder:r.title||"留空則取用標題"},null,8,["value","placeholder"])]),_:1}),l(a(v),{label:"Meta Description",path:"seo.meta_description"},{default:i(()=>[l(a(V),{value:r.seo.meta_description,"onUpdate:value":e[8]||(e[8]=s=>r.seo.meta_description=s),type:"textarea",placeholder:"建議 150 字內",rows:3},null,8,["value"])]),_:1})]),_:1}),l(a(B),{name:"publish",tab:"發佈設定"},{default:i(()=>[l(a(X),{cols:2,"x-gap":20},{default:i(()=>[l(a(M),null,{default:i(()=>[l(a(v),{label:"發佈開始時間",path:"publish_start"},{default:i(()=>[l(a(j),{value:D.value,"onUpdate:value":e[9]||(e[9]=s=>D.value=s),type:"datetime"},null,8,["value"])]),_:1})]),_:1}),l(a(M),null,{default:i(()=>[l(a(v),{label:"發佈結束時間 (永不下架則不填)",path:"publish_end"},{default:i(()=>[l(a(j),{value:x.value,"onUpdate:value":e[10]||(e[10]=s=>x.value=s),type:"datetime",clearable:""},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])]))}}),vt=ie(Ae,[["__scopeId","data-v-94089882"]]);export{vt as default};
