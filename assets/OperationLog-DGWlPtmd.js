import{a as d,c as I,b as U,aw as oe,ax as re,ay as ae,e as H,h as le,u as se,f as Z,ar as ne,g as de,j as h,az as ie,au as $,s as v,v as y,w as t,y as ue,r as k,aA as pe,F as s,C as K,D as u,J as f,X as be,W as _,E as n,K as W,G as i,Q,I as ce,H as me,a1 as ve,a0 as X,a5 as ge,_ as fe}from"./index-BsKuKuBe.js";import{N as q}from"./DatePicker-CVYfnur-.js";import{N as J}from"./Select-CCDzjsmj.js";import{N as Y}from"./Spin-D6NC1_9t.js";import{N as ye}from"./Pagination-BLbp2o8H.js";import{N as xe,a as F}from"./Tabs-CMKBZqEE.js";import{N as D}from"./Tag-I3_cH6qL.js";import{N as he}from"./Icon-CbayTH31.js";import"./use-keyboard-kkRvbDTj.js";import"./Popover-CfBNgOAF.js";import"./use-compitable-BjMNwQgq.js";import"./Forward-CBwL8ab_.js";import"./create-Bj8PAPmY.js";import"./Empty-DtuLCoXR.js";import"./create-ref-setter-C4J8sofl.js";import"./Add-BJRbFrfV.js";import"./toNumber-By67wpTM.js";const _e=d([I("table",`
 font-size: var(--n-font-size);
 font-variant-numeric: tabular-nums;
 line-height: var(--n-line-height);
 width: 100%;
 border-radius: var(--n-border-radius) var(--n-border-radius) 0 0;
 text-align: left;
 border-collapse: separate;
 border-spacing: 0;
 overflow: hidden;
 background-color: var(--n-td-color);
 border-color: var(--n-merged-border-color);
 transition:
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
 --n-merged-border-color: var(--n-border-color);
 `,[d("th",`
 white-space: nowrap;
 transition:
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
 text-align: inherit;
 padding: var(--n-th-padding);
 vertical-align: inherit;
 text-transform: none;
 border: 0px solid var(--n-merged-border-color);
 font-weight: var(--n-th-font-weight);
 color: var(--n-th-text-color);
 background-color: var(--n-th-color);
 border-bottom: 1px solid var(--n-merged-border-color);
 border-right: 1px solid var(--n-merged-border-color);
 `,[d("&:last-child",`
 border-right: 0px solid var(--n-merged-border-color);
 `)]),d("td",`
 transition:
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
 padding: var(--n-td-padding);
 color: var(--n-td-text-color);
 background-color: var(--n-td-color);
 border: 0px solid var(--n-merged-border-color);
 border-right: 1px solid var(--n-merged-border-color);
 border-bottom: 1px solid var(--n-merged-border-color);
 `,[d("&:last-child",`
 border-right: 0px solid var(--n-merged-border-color);
 `)]),U("bordered",`
 border: 1px solid var(--n-merged-border-color);
 border-radius: var(--n-border-radius);
 `,[d("tr",[d("&:last-child",[d("td",`
 border-bottom: 0 solid var(--n-merged-border-color);
 `)])])]),U("single-line",[d("th",`
 border-right: 0px solid var(--n-merged-border-color);
 `),d("td",`
 border-right: 0px solid var(--n-merged-border-color);
 `)]),U("single-column",[d("tr",[d("&:not(:last-child)",[d("td",`
 border-bottom: 0px solid var(--n-merged-border-color);
 `)])])]),U("striped",[d("tr:nth-of-type(even)",[d("td","background-color: var(--n-td-color-striped)")])]),oe("bottom-bordered",[d("tr",[d("&:last-child",[d("td",`
 border-bottom: 0px solid var(--n-merged-border-color);
 `)])])])]),re(I("table",`
 background-color: var(--n-td-color-modal);
 --n-merged-border-color: var(--n-border-color-modal);
 `,[d("th",`
 background-color: var(--n-th-color-modal);
 `),d("td",`
 background-color: var(--n-td-color-modal);
 `)])),ae(I("table",`
 background-color: var(--n-td-color-popover);
 --n-merged-border-color: var(--n-border-color-popover);
 `,[d("th",`
 background-color: var(--n-th-color-popover);
 `),d("td",`
 background-color: var(--n-td-color-popover);
 `)]))]),Ce=Object.assign(Object.assign({},Z.props),{bordered:{type:Boolean,default:!0},bottomBordered:{type:Boolean,default:!0},singleLine:{type:Boolean,default:!0},striped:Boolean,singleColumn:Boolean,size:{type:String,default:"medium"}}),we=H({name:"Table",props:Ce,setup(c){const{mergedClsPrefixRef:p,inlineThemeDisabled:g,mergedRtlRef:R}=se(c),C=Z("Table","-table",_e,ie,c,p),w=ne("Table",R,p),E=h(()=>{const{size:x}=c,{self:{borderColor:l,tdColor:T,tdColorModal:m,tdColorPopover:L,thColor:P,thColorModal:A,thColorPopover:N,thTextColor:V,tdTextColor:O,borderRadius:z,thFontWeight:j,lineHeight:B,borderColorModal:M,borderColorPopover:G,tdColorStriped:o,tdColorStripedModal:e,tdColorStripedPopover:b,[$("fontSize",x)]:r,[$("tdPadding",x)]:S,[$("thPadding",x)]:ee},common:{cubicBezierEaseInOut:te}}=C.value;return{"--n-bezier":te,"--n-td-color":T,"--n-td-color-modal":m,"--n-td-color-popover":L,"--n-td-text-color":O,"--n-border-color":l,"--n-border-color-modal":M,"--n-border-color-popover":G,"--n-border-radius":z,"--n-font-size":r,"--n-th-color":P,"--n-th-color-modal":A,"--n-th-color-popover":N,"--n-th-font-weight":j,"--n-th-text-color":V,"--n-line-height":B,"--n-td-padding":S,"--n-th-padding":ee,"--n-td-color-striped":o,"--n-td-color-striped-modal":e,"--n-td-color-striped-popover":b}}),a=g?de("table",h(()=>c.size[0]),E,c):void 0;return{rtlEnabled:w,mergedClsPrefix:p,cssVars:g?void 0:E,themeClass:a==null?void 0:a.themeClass,onRender:a==null?void 0:a.onRender}},render(){var c;const{mergedClsPrefix:p}=this;return(c=this.onRender)===null||c===void 0||c.call(this),le("table",{class:[`${p}-table`,this.themeClass,{[`${p}-table--rtl`]:this.rtlEnabled,[`${p}-table--bottom-bordered`]:this.bottomBordered,[`${p}-table--bordered`]:this.bordered,[`${p}-table--single-line`]:this.singleLine,[`${p}-table--single-column`]:this.singleColumn,[`${p}-table--striped`]:this.striped}],style:this.cssVars},this.$slots)}}),Ee={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Te=H({name:"VisibilityOutlined",render:function(p,g){return v(),y("svg",Ee,g[0]||(g[0]=[t("path",{d:"M12 6a9.77 9.77 0 0 1 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5A9.77 9.77 0 0 1 12 6m0-2C7 4 2.73 7.11 1 11.5C2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5a2.5 2.5 0 0 1 0 5a2.5 2.5 0 0 1 0-5m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z",fill:"currentColor"},null,-1)]))}}),Ne={class:"p-6 space-y-4"},Se={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4"},ke={class:"flex gap-3 mt-4"},De={class:"text-sm text-gray-600 leading-10"},Oe={class:"font-semibold"},ze={class:"min-w-full border-collapse border border-gray-300"},Ue={class:"border border-gray-300 px-4 py-2"},Re={class:"font-mono text-sm"},Le={class:"border border-gray-300 px-4 py-2"},Pe={class:"border border-gray-300 px-4 py-2"},Ae={class:"font-semibold"},Ve={class:"border border-gray-300 px-4 py-2"},je={class:"border border-gray-300 px-4 py-2"},Be={class:"border border-gray-300 px-4 py-2"},Me={class:"border border-gray-300 px-4 py-2"},Ge={class:"border border-gray-300 px-4 py-2 text-center"},Ie={class:"flex justify-end mt-4"},$e={class:"space-y-4 max-h-96 overflow-y-auto"},Je={class:"bg-gray-100 p-3 rounded text-sm font-mono"},Fe={key:0},He={class:"bg-red-50 p-3 rounded text-sm font-mono whitespace-pre-wrap break-words"},Ke={key:1},We={class:"bg-green-50 p-3 rounded text-sm font-mono whitespace-pre-wrap break-words"},Qe={key:2},Xe={class:"bg-red-100 p-3 rounded text-sm text-red-800"},qe={class:"space-y-3"},Ye={class:"flex justify-between"},Ze={class:"font-mono"},et={class:"flex justify-between"},tt={class:"flex justify-between"},ot={class:"flex justify-between"},rt={class:"flex justify-between"},at={class:"font-mono"},lt={key:0,class:"flex justify-between"},st={class:"text-xs"},nt=H({__name:"OperationLog",setup(c){const p=Te,g=ue(),R=h(()=>{const o={};return ge.forEach(e=>{o[e.code]=e.name}),o.LOGIN="系統登錄",o.LOGOUT="系統登出",o}),C=o=>R.value[o]||o,w=k([...pe].reverse()),E=k(!1),a=X({startDate:null,endDate:null,operatorUsername:"",module:"",operationType:""}),x=k(!1),l=k(null),T=k("json"),m=X({page:1,pageSize:20}),L=[{label:"全部",value:""},{label:"新增 (Create)",value:"CREATE"},{label:"修改 (Update)",value:"UPDATE"},{label:"刪除 (Delete)",value:"DELETE"},{label:"登入",value:"LOGIN"},{label:"登出",value:"LOGOUT"}],P=h(()=>{const o=new Set(w.value.map(e=>e.module));return[{label:"全部",value:""},...Array.from(o).sort().map(e=>({label:C(e),value:e}))]}),A=h(()=>{const o=new Set(w.value.map(e=>e.operator_username));return[{label:"全部",value:""},...Array.from(o).sort().map(e=>({label:e,value:e}))]}),N=h(()=>w.value.filter(o=>{var e;return!(a.startDate&&new Date(o.timestamp).getTime()<a.startDate||a.endDate&&new Date(o.timestamp).getTime()>a.endDate||a.operatorUsername&&o.operator_username!==a.operatorUsername||a.module&&o.module!==a.module||a.operationType&&o.operation_type!==a.operationType||((e=g.user)==null?void 0:e.role)==="USER"&&o.operator_id!==g.user.user_id)})),V=h(()=>{const o=(m.page-1)*m.pageSize;return N.value.slice(o,o+m.pageSize)}),O=o=>{switch(o){case"CREATE":return"success";case"UPDATE":return"warning";case"DELETE":return"error";case"LOGIN":return"info";case"LOGOUT":return"default";default:return"default"}},z=o=>o==="SUCCESS"?"success":"error",j=o=>{switch(o){case"DEVELOPER":return"error";case"MANAGER":return"warning";case"USER":return"default";default:return"default"}},B=o=>{l.value=o,x.value=!0,T.value="json"},M=o=>{const e=[];return o.old_value&&Object.entries(o.old_value).forEach(([b,r])=>{var S;e.push({field:b,oldValue:JSON.stringify(r),newValue:(S=o.new_value)!=null&&S[b]?JSON.stringify(o.new_value[b]):"-"})}),o.new_value&&o.operation_type==="CREATE"&&Object.entries(o.new_value).forEach(([b,r])=>{(!o.old_value||!(b in o.old_value))&&e.push({field:b,oldValue:"-",newValue:JSON.stringify(r)})}),e},G=()=>{a.startDate=null,a.endDate=null,a.operatorUsername="",a.module="",a.operationType="",m.page=1};return(o,e)=>{var b;return v(),y("div",Ne,[e[29]||(e[29]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900"},"後台操作日誌"),t("p",{class:"text-gray-600 mt-1"},"查詢和審計所有管理員操作記錄")],-1)),((b=s(g).user)==null?void 0:b.role)==="USER"?(v(),K(s(be),{key:0,type:"info"},{default:u(()=>[...e[8]||(e[8]=[f(" 您作為一般使用者，只能查看自己的操作日誌。 ",-1)])]),_:1})):_("",!0),n(s(Q),{title:"篩選條件",bordered:!1},{default:u(()=>[t("div",Se,[t("div",null,[e[9]||(e[9]=t("label",{class:"text-sm font-semibold text-gray-700 block mb-2"}," 開始日期 ",-1)),n(s(q),{value:a.startDate,"onUpdate:value":e[0]||(e[0]=r=>a.startDate=r),type:"datetime",clearable:"",placeholder:"選擇開始日期"},null,8,["value"])]),t("div",null,[e[10]||(e[10]=t("label",{class:"text-sm font-semibold text-gray-700 block mb-2"}," 結束日期 ",-1)),n(s(q),{value:a.endDate,"onUpdate:value":e[1]||(e[1]=r=>a.endDate=r),type:"datetime",clearable:"",placeholder:"選擇結束日期"},null,8,["value"])]),t("div",null,[e[11]||(e[11]=t("label",{class:"text-sm font-semibold text-gray-700 block mb-2"}," 操作人員 ",-1)),n(s(J),{value:a.operatorUsername,"onUpdate:value":e[2]||(e[2]=r=>a.operatorUsername=r),options:A.value,filterable:""},null,8,["value","options"])]),t("div",null,[e[12]||(e[12]=t("label",{class:"text-sm font-semibold text-gray-700 block mb-2"}," 功能模組 ",-1)),n(s(J),{value:a.module,"onUpdate:value":e[3]||(e[3]=r=>a.module=r),options:P.value,filterable:""},null,8,["value","options"])]),t("div",null,[e[13]||(e[13]=t("label",{class:"text-sm font-semibold text-gray-700 block mb-2"}," 操作類型 ",-1)),n(s(J),{value:a.operationType,"onUpdate:value":e[4]||(e[4]=r=>a.operationType=r),options:L},null,8,["value"])])]),t("div",ke,[n(s(W),{type:"primary",ghost:"",onClick:G},{default:u(()=>[...e[14]||(e[14]=[f(" 重置篩選 ",-1)])]),_:1}),t("p",De,[e[15]||(e[15]=f(" 找到 ",-1)),t("span",Oe,i(N.value.length),1),e[16]||(e[16]=f(" 筆操作記錄 ",-1))])])]),_:1}),n(s(Q),{bordered:!1},{default:u(()=>[n(s(Y),{show:E.value},{default:u(()=>[t("table",ze,[e[17]||(e[17]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"border border-gray-300 px-4 py-2 text-left w-20"},"日誌編號"),t("th",{class:"border border-gray-300 px-4 py-2 text-left w-40"},"操作時間"),t("th",{class:"border border-gray-300 px-4 py-2 text-left w-28"},"操作者"),t("th",{class:"border border-gray-300 px-4 py-2 text-left w-24"},"身份"),t("th",{class:"border border-gray-300 px-4 py-2 text-left w-28"},"功能模組"),t("th",{class:"border border-gray-300 px-4 py-2 text-left w-24"},"操作類型"),t("th",{class:"border border-gray-300 px-4 py-2 text-left w-20"},"執行結果"),t("th",{class:"border border-gray-300 px-4 py-2 text-center w-16"},"操作")])],-1)),t("tbody",null,[(v(!0),y(ce,null,me(V.value,r=>(v(),y("tr",{key:r.id,class:"border border-gray-300 hover:bg-gray-50"},[t("td",Ue,[t("span",Re,i(r.id),1)]),t("td",Le,i(r.timestamp),1),t("td",Pe,[t("span",Ae,i(r.operator_username),1)]),t("td",Ve,[n(s(D),{type:j(r.operator_role)},{default:u(()=>[f(i(r.operator_role==="DEVELOPER"?"技術開發":r.operator_role==="MANAGER"?"營運主管":"一般職員"),1)]),_:2},1032,["type"])]),t("td",je,i(C(r.module)),1),t("td",Be,[n(s(D),{type:O(r.operation_type)},{default:u(()=>[f(i(r.operation_type==="CREATE"?"新增":r.operation_type==="UPDATE"?"修改":r.operation_type==="DELETE"?"刪除":r.operation_type==="LOGIN"?"登入":r.operation_type==="LOGOUT"?"登出":r.operation_type),1)]),_:2},1032,["type"])]),t("td",Me,[n(s(D),{type:z(r.result)},{default:u(()=>[f(i(r.result==="SUCCESS"?"成功":"失敗"),1)]),_:2},1032,["type"])]),t("td",Ge,[n(s(W),{text:"",type:"primary",size:"small",onClick:S=>B(r)},{icon:u(()=>[n(s(he),{size:"18"},{default:u(()=>[n(s(p))]),_:1})]),_:1},8,["onClick"])])]))),128))])]),t("div",Ie,[n(s(ye),{page:m.page,"onUpdate:page":e[5]||(e[5]=r=>m.page=r),"page-size":m.pageSize,"page-count":Math.ceil(N.value.length/m.pageSize)},null,8,["page","page-size","page-count"])])]),_:1},8,["show"])]),_:1}),n(s(ve),{show:x.value,"onUpdate:show":e[7]||(e[7]=r=>x.value=r),title:"操作詳情",preset:"dialog",size:"large",class:"max-h-[90vh]"},{default:u(()=>[l.value?(v(),K(s(Y),{key:0,show:E.value},{default:u(()=>[n(s(xe),{value:T.value,"onUpdate:value":e[6]||(e[6]=r=>T.value=r),type:"line"},{default:u(()=>[n(s(F),{name:"json",tab:"JSON 格式"},{default:u(()=>[t("div",$e,[t("div",null,[e[18]||(e[18]=t("p",{class:"text-sm font-semibold text-gray-700 mb-2"},"操作時間：",-1)),t("p",null,i(l.value.timestamp),1)]),t("div",null,[e[19]||(e[19]=t("p",{class:"text-sm font-semibold text-gray-700 mb-2"}," 操作者資訊： ",-1)),t("div",Je,i(JSON.stringify({operator_id:l.value.operator_id,operator_username:l.value.operator_username,operator_role:l.value.operator_role,source_ip:l.value.source_ip},null,2)),1)]),l.value.old_value?(v(),y("div",Fe,[e[20]||(e[20]=t("p",{class:"text-sm font-semibold text-gray-700 mb-2"},"修改前：",-1)),t("div",He,i(JSON.stringify(l.value.old_value,null,2)),1)])):_("",!0),l.value.new_value?(v(),y("div",Ke,[e[21]||(e[21]=t("p",{class:"text-sm font-semibold text-gray-700 mb-2"},"修改後：",-1)),t("div",We,i(JSON.stringify(l.value.new_value,null,2)),1)])):_("",!0),l.value.error_reason?(v(),y("div",Qe,[e[22]||(e[22]=t("p",{class:"text-sm font-semibold text-gray-700 mb-2"}," 錯誤原因： ",-1)),t("div",Xe,i(l.value.error_reason),1)])):_("",!0)])]),_:1}),n(s(F),{name:"table",tab:"對照表格式"},{default:u(()=>[n(s(we),{columns:[{title:"欄位",key:"field"},{title:"修改前",key:"oldValue"},{title:"修改後",key:"newValue"}],data:M(l.value),size:"small"},null,8,["data"])]),_:1}),n(s(F),{name:"info",tab:"基本資訊"},{default:u(()=>[t("div",qe,[t("div",Ye,[e[23]||(e[23]=t("span",{class:"text-gray-700"},"日誌編號：",-1)),t("span",Ze,i(l.value.id),1)]),t("div",et,[e[24]||(e[24]=t("span",{class:"text-gray-700"},"操作功能：",-1)),t("span",null,i(C(l.value.module)),1)]),t("div",tt,[e[25]||(e[25]=t("span",{class:"text-gray-700"},"操作類型：",-1)),n(s(D),{type:O(l.value.operation_type)},{default:u(()=>[f(i(l.value.operation_type==="CREATE"?"新增":l.value.operation_type==="UPDATE"?"修改":l.value.operation_type==="DELETE"?"刪除":l.value.operation_type),1)]),_:1},8,["type"])]),t("div",ot,[e[26]||(e[26]=t("span",{class:"text-gray-700"},"執行結果：",-1)),n(s(D),{type:z(l.value.result)},{default:u(()=>[f(i(l.value.result==="SUCCESS"?"成功":"失敗"),1)]),_:1},8,["type"])]),t("div",rt,[e[27]||(e[27]=t("span",{class:"text-gray-700"},"來源 IP：",-1)),t("span",at,i(l.value.source_ip),1)]),l.value.user_agent?(v(),y("div",lt,[e[28]||(e[28]=t("span",{class:"text-gray-700"},"User-Agent：",-1)),t("span",st,i(l.value.user_agent),1)])):_("",!0)])]),_:1})]),_:1},8,["value"])]),_:1},8,["show"])):_("",!0)]),_:1},8,["show"])])}}}),Tt=fe(nt,[["__scopeId","data-v-91b4f5a8"]]);export{Tt as default};
