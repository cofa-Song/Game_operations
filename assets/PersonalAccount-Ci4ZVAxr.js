import{e as F,v as U,w as d,s as h,y as T,P as B,A as D,o as M,G as u,F as e,C as V,D as l,J as v,E as o,X as $,W as q,U as b,Q as y,Y as N,Z as c,$ as m,K as x,T as E,r as g,a0 as C,_ as G}from"./index-BsKuKuBe.js";import{N as W}from"./Select-CCDzjsmj.js";import{N as Z}from"./Switch-DXNn_bI_.js";import{N as L}from"./Icon-CbayTH31.js";import{N as k}from"./Divider-DILe50Hg.js";import"./Popover-CfBNgOAF.js";import"./use-compitable-BjMNwQgq.js";import"./Tag-I3_cH6qL.js";import"./create-Bj8PAPmY.js";import"./Empty-DtuLCoXR.js";const O={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},j=F({name:"CheckCircleOutlined",render:function(w,i){return h(),U("svg",O,i[0]||(i[0]=[d("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8s-3.59 8-8 8zm4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4l8-8z",fill:"currentColor"},null,-1)]))}}),H={class:"w-full"},J={class:"p-6 space-y-6"},K={class:"text-3xl font-bold text-gray-900"},Q={class:"text-gray-600 mt-1"},X={class:"mb-6"},Y={class:"flex justify-between items-center"},ee={class:"font-semibold text-gray-900"},se={class:"text-sm text-gray-600 mt-1"},oe={class:"font-semibold text-gray-900 mb-4"},ae=F({__name:"PersonalAccount",setup(z){const w=T(),i=B(),{t:s,locale:A}=D(),p=g(!1),P=g(!1),n=C({username:"",displayName:"",email:"",language:"zh-TW",twoFactorAuth:!1}),r=C({oldPassword:"",newPassword:"",confirmPassword:""}),_=g(),I=[{label:"English",value:"en"},{label:"繁體中文",value:"zh-TW"},{label:"簡體中文",value:"zh-CN"}];M(()=>{w.user&&(n.username=w.user.user_id||"",n.displayName=w.user.name||"",n.email=w.user.email||"",n.language=A.value)});const R=async()=>{var f;try{await((f=_.value)==null?void 0:f.validate()),p.value=!0,await new Promise(a=>setTimeout(a,500)),A.value=n.language,i.success(s("permission.personalAccount.success"))}catch{i.error(s("common.error"))}finally{p.value=!1}},S=async()=>{try{if(!r.oldPassword){i.warning(s("permission.personalAccount.oldPasswordRequired"));return}if(!r.newPassword){i.warning(s("permission.personalAccount.newPasswordRequired"));return}if(!r.confirmPassword){i.warning(s("permission.personalAccount.confirmPasswordRequired"));return}if(r.newPassword!==r.confirmPassword){i.error(s("permission.personalAccount.passwordMismatch"));return}if(r.oldPassword===r.newPassword){i.error(s("permission.personalAccount.passwordDuplicate"));return}if(!/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z0-9]{8,16}$/.test(r.newPassword)){i.error(s("permission.personalAccount.passwordInvalid"));return}p.value=!0,await new Promise(a=>setTimeout(a,500)),r.oldPassword="",r.newPassword="",r.confirmPassword="",P.value=!0,i.success(`${s("permission.personalAccount.passwordChanged")}，將在 3 秒後刷新頁面`),setTimeout(()=>{window.location.href="/login"},3e3)}catch{i.error(s("common.error"))}finally{p.value=!1}};return(f,a)=>(h(),U("div",H,[d("div",J,[d("div",null,[d("h1",K,u(e(s)("permission.personalAccount.title")),1),d("p",Q,u(e(s)("permission.personalAccount.description")),1)]),P.value?(h(),V(e($),{key:0,type:"success",closable:""},{icon:l(()=>[o(e(L),null,{default:l(()=>[o(e(j))]),_:1})]),default:l(()=>[v(" "+u(e(s)("permission.personalAccount.passwordChanged"))+"！"+u(e(s)("permission.personalAccount.passwordChangedDesc"))+"。 ",1)]),_:1})):q("",!0),o(e(E),{cols:1,responsive:"screen"},{default:l(()=>[o(e(b),null,{default:l(()=>[o(e(y),{title:e(s)("permission.personalAccount.personalInfo"),bordered:!0},{default:l(()=>[o(e(N),{ref_key:"personalFormRef",ref:_,model:n,"label-placement":"top","label-width":"120"},{default:l(()=>[o(e(c),{label:e(s)("permission.personalAccount.accountNumber"),path:"username"},{default:l(()=>[o(e(m),{value:n.username,"onUpdate:value":a[0]||(a[0]=t=>n.username=t),disabled:""},null,8,["value"])]),_:1},8,["label"]),o(e(c),{label:e(s)("permission.personalAccount.displayName"),path:"displayName"},{default:l(()=>[o(e(m),{value:n.displayName,"onUpdate:value":a[1]||(a[1]=t=>n.displayName=t),placeholder:e(s)("permission.personalAccount.displayName"),maxlength:"20"},null,8,["value","placeholder"])]),_:1},8,["label"]),o(e(c),{label:e(s)("permission.personalAccount.email"),path:"email"},{default:l(()=>[o(e(m),{value:n.email,"onUpdate:value":a[2]||(a[2]=t=>n.email=t),placeholder:e(s)("permission.personalAccount.email")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(e(c),{label:e(s)("permission.personalAccount.language"),path:"language"},{default:l(()=>[o(e(W),{value:n.language,"onUpdate:value":a[3]||(a[3]=t=>n.language=t),options:I},null,8,["value"])]),_:1},8,["label"]),o(e(x),{type:"primary",loading:p.value,onClick:R,class:"mt-4"},{default:l(()=>[v(u(e(s)("common.save")),1)]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1}),o(e(k)),o(e(b),null,{default:l(()=>[o(e(y),{title:e(s)("permission.personalAccount.securitySettings"),bordered:!0},{default:l(()=>[d("div",X,[d("div",Y,[d("div",null,[d("p",ee,u(e(s)("permission.personalAccount.twoFactorAuth")),1),d("p",se,u(e(s)("permission.personalAccount.twoFactorAuthDesc")),1)]),o(e(Z),{value:n.twoFactorAuth,"onUpdate:value":a[4]||(a[4]=t=>n.twoFactorAuth=t)},null,8,["value"])])]),o(e(k)),d("div",null,[d("p",oe,u(e(s)("permission.personalAccount.changePassword")),1),o(e(N),{ref:"passwordFormRef",model:r,"label-placement":"top","label-width":"120"},{default:l(()=>[o(e(c),{label:e(s)("permission.personalAccount.oldPassword"),path:"oldPassword"},{default:l(()=>[o(e(m),{value:r.oldPassword,"onUpdate:value":a[5]||(a[5]=t=>r.oldPassword=t),type:"password",placeholder:e(s)("permission.personalAccount.oldPassword"),"show-password-on":"click"},null,8,["value","placeholder"])]),_:1},8,["label"]),o(e(c),{label:e(s)("permission.personalAccount.newPassword"),path:"newPassword"},{default:l(()=>[o(e(m),{value:r.newPassword,"onUpdate:value":a[6]||(a[6]=t=>r.newPassword=t),type:"password",placeholder:e(s)("permission.personalAccount.passwordHint"),"show-password-on":"click"},null,8,["value","placeholder"])]),_:1},8,["label"]),o(e(c),{label:e(s)("permission.personalAccount.confirmPassword"),path:"confirmPassword"},{default:l(()=>[o(e(m),{value:r.confirmPassword,"onUpdate:value":a[7]||(a[7]=t=>r.confirmPassword=t),type:"password",placeholder:e(s)("permission.personalAccount.confirmPassword"),"show-password-on":"click"},null,8,["value","placeholder"])]),_:1},8,["label"]),o(e(x),{type:"warning",loading:p.value,onClick:S,class:"mt-4"},{default:l(()=>[v(u(e(s)("permission.personalAccount.changePassword")),1)]),_:1},8,["loading"])]),_:1},8,["model"])])]),_:1},8,["title"])]),_:1})]),_:1})])]))}}),we=G(ae,[["__scopeId","data-v-d51028ef"]]);export{we as default};
