import{e as Q,P as q,o as Y,L as Z,l as ee,v as A,E as t,D as e,F as a,Q as d,J as o,S as te,G as r,K as z,T as I,U as f,V as G,w as R,W as ae,r as p,j as w,M as le,s as H,_ as se}from"./index-BsKuKuBe.js";import{i as B}from"./index-D5fw03LZ.js";import{N as M}from"./Space-Cf9Hs1lp.js";import{N as oe}from"./RadioGroup-CgIVku-C.js";import{N as O}from"./RadioButton-Bm_8G4Bh.js";import{N as ne}from"./Divider-DILe50Hg.js";import{N as C}from"./text-BDsrB_Xz.js";import{R as ie}from"./Refresh-N_ZHlcGf.js";import{N as m}from"./Statistic-C8A6-kum.js";import{N as re}from"./Tag-I3_cH6qL.js";import{N as ue}from"./Icon-CbayTH31.js";import"./use-compitable-BjMNwQgq.js";const de=g=>new Promise(n=>setTimeout(n,g)),fe={async getStats(g){await de(600);let n=g.excludeTest?1:1.2;const y=new Date(g.startDate),_=new Date(g.endDate),S=Math.abs(_.getTime()-y.getTime());if(Math.ceil(S/(1e3*60*60*24))>2)n*=6.5;else{const u=new Date;y.getDate()===u.getDate()&&y.getMonth()===u.getMonth()||(n*=.85)}const b=Math.floor(15e4*n),s=Math.floor(35e4*n),h=Math.floor(2e5*n),x=Math.floor(12e3*n),T=b+s+h;return{code:0,msg:"success",data:{totalDeposit:Math.floor(125e4*n),totalWithdraw:Math.floor(45e4*n),netRevenue:Math.floor(8e5*n),manualAddCash:Math.floor(5e3*n),manualDeductCash:0,manualAddBonus:x,manualDeductBonus:500,ggr:Math.floor(85e4*n),depositCount:Math.floor(320*n),depositUserCount:Math.floor(280*n),activeUserCount:Math.floor(1500*n),totalDistribution:T,totalRecovery:b,totalConversion:s,totalInProgress:h,channelStats:[{name:"USDT",value:8e5},{name:"Bank Transfer",value:3e5},{name:"Credit Card",value:15e4}],withdrawChannelStats:[{name:"USDT",value:4e5},{name:"Bank Transfer",value:5e4}]}}}},ve={class:"financial-overview-container"},ce={key:0,class:"alert-action"},pe=5e4,me=Q({__name:"FinancialOverview",setup(g){const n=le(),y=q(),_=p(!1),S=p("today"),k=p(!0),b=p(""),s=p({totalDeposit:0,totalWithdraw:0,netRevenue:0,manualAddCash:0,manualDeductCash:0,manualAddBonus:0,manualDeductBonus:0,ggr:0,depositCount:0,activeUserCount:0,channelStats:[],withdrawChannelStats:[],totalDistribution:0,totalRecovery:0,totalConversion:0,totalInProgress:0,depositUserCount:0}),h=p(null),x=p(null),T=p(null);let u=null,v=null,c=null,L=null;const U=w(()=>s.value.manualAddCash>pe),P=w(()=>s.value.activeUserCount===0?0:(s.value.depositUserCount/s.value.activeUserCount*100).toFixed(2)),E=w(()=>s.value.totalDistribution===0?0:(s.value.totalConversion/s.value.totalDistribution*100).toFixed(2)),F=D=>{const l=new Date,i=new Date;return D==="yesterday"?(i.setDate(i.getDate()-1),i.setHours(0,0,0,0),l.setDate(l.getDate()-1),l.setHours(23,59,59,999)):D==="week"?i.setDate(i.getDate()-7):i.setHours(0,0,0,0),{startDate:i.toISOString(),endDate:l.toISOString()}},V=w(()=>`入金渠道分佈 (Total: $${s.value.totalDeposit.toLocaleString()})`),W=w(()=>`出金渠道分佈 (Total: $${s.value.totalWithdraw.toLocaleString()})`),j=w(()=>`總派發活動金 (Total: $${s.value.totalDistribution.toLocaleString()})`),N=async()=>{_.value=!0;try{const{startDate:D,endDate:l}=F(S.value),i=await fe.getStats({startDate:D,endDate:l,excludeTest:k.value});i.code===0&&i.data&&(s.value=i.data,b.value=new Date().toLocaleTimeString(),J())}catch{y.error("數據載入失敗")}finally{_.value=!1}},X=()=>{h.value&&(u=B(h.value)),x.value&&(v=B(x.value)),T.value&&(c=B(T.value))},J=()=>{u&&u.setOption({tooltip:{trigger:"item"},legend:{bottom:"0%"},series:[{name:"入金渠道",type:"pie",radius:"55%",avoidLabelOverlap:!1,data:s.value.channelStats,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),v&&v.setOption({tooltip:{trigger:"item"},legend:{bottom:"0%"},series:[{name:"出金渠道",type:"pie",radius:"55%",avoidLabelOverlap:!1,data:s.value.withdrawChannelStats,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),c&&c.setOption({tooltip:{trigger:"item"},legend:{bottom:"0%"},series:[{name:"派發結構",type:"pie",radius:"55%",avoidLabelOverlap:!1,data:[{value:s.value.totalRecovery,name:"總回收"},{value:s.value.totalConversion,name:"總轉換"},{value:s.value.totalInProgress,name:"進行中"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]})},$=()=>{u==null||u.resize(),v==null||v.resize(),c==null||c.resize()},K=()=>{n.push("/admin/manual-adjustment")};return Y(()=>{Z(()=>{X(),N(),window.addEventListener("resize",$)}),L=window.setInterval(N,6e4)}),ee(()=>{L&&clearInterval(L),window.removeEventListener("resize",$),u==null||u.dispose(),v==null||v.dispose(),c==null||c.dispose()}),(D,l)=>(H(),A("div",ve,[t(a(M),{vertical:"",size:"large"},{default:e(()=>[t(a(d),null,{default:e(()=>[t(a(M),{align:"center",justify:"space-between"},{default:e(()=>[t(a(M),{align:"center"},{default:e(()=>[t(a(oe),{value:S.value,"onUpdate:value":[l[0]||(l[0]=i=>S.value=i),N]},{default:e(()=>[t(a(O),{value:"today"},{default:e(()=>[...l[2]||(l[2]=[o("今日",-1)])]),_:1}),t(a(O),{value:"yesterday"},{default:e(()=>[...l[3]||(l[3]=[o("昨日",-1)])]),_:1}),t(a(O),{value:"week"},{default:e(()=>[...l[4]||(l[4]=[o("過去 7 天",-1)])]),_:1})]),_:1},8,["value"]),t(a(ne),{vertical:""}),t(a(te),{checked:k.value,"onUpdate:checked":[l[1]||(l[1]=i=>k.value=i),N]},{default:e(()=>[...l[5]||(l[5]=[o(" 排除測試帳號 ",-1)])]),_:1},8,["checked"])]),_:1}),t(a(M),{align:"center"},{default:e(()=>[t(a(C),{depth:"3",class:"last-updated"},{default:e(()=>[o(" 最後更新: "+r(b.value),1)]),_:1}),t(a(z),{secondary:"",circle:"",type:"primary",onClick:N,loading:_.value},{icon:e(()=>[t(a(ue),null,{default:e(()=>[t(a(ie))]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}),t(a(I),{"x-gap":"12","y-gap":"12",cols:4},{default:e(()=>[t(a(f),null,{default:e(()=>[t(a(d),{class:"kpi-card"},{default:e(()=>[t(a(m),{label:"今日總儲值 (Net)"},{prefix:e(()=>[...l[6]||(l[6]=[o("$",-1)])]),default:e(()=>[o(" "+r(s.value.totalDeposit.toLocaleString()),1)]),_:1}),t(a(C),{depth:"3",class:"sub-text"},{default:e(()=>[o("筆數: "+r(s.value.depositCount),1)]),_:1})]),_:1})]),_:1}),t(a(f),null,{default:e(()=>[t(a(d),{class:"kpi-card"},{default:e(()=>[t(a(m),{label:"今日總兌換 (Total Out)"},{prefix:e(()=>[...l[7]||(l[7]=[o("$",-1)])]),default:e(()=>[o(" "+r(s.value.totalWithdraw.toLocaleString()),1)]),_:1}),t(a(C),{depth:"3",class:"sub-text"},{default:e(()=>[o("筆數: "+r(s.value.withdrawChannelStats.length*15),1)]),_:1})]),_:1})]),_:1}),t(a(f),null,{default:e(()=>[t(a(d),{class:G(["kpi-card",{"alert-flash":U.value}])},{default:e(()=>[t(a(m),{label:"人工加點合計 (Cash)"},{prefix:e(()=>[...l[8]||(l[8]=[o("$",-1)])]),default:e(()=>[R("span",{class:G({"text-warn":U.value})},r(s.value.manualAddCash.toLocaleString()),3)]),_:1}),U.value?(H(),A("div",ce,[t(a(re),{type:"error",size:"small"},{default:e(()=>[...l[9]||(l[9]=[o("異常高",-1)])]),_:1}),t(a(z),{text:"",type:"error",size:"tiny",class:"ml-2",onClick:K},{default:e(()=>[...l[10]||(l[10]=[o(" 查看詳情 > ",-1)])]),_:1})])):ae("",!0)]),_:1},8,["class"])]),_:1}),t(a(f),null,{default:e(()=>[t(a(d),{class:"kpi-card"},{default:e(()=>[t(a(m),{label:"人工扣點合計 (Cash)"},{prefix:e(()=>[...l[11]||(l[11]=[o("$",-1)])]),default:e(()=>[o(" "+r(s.value.manualDeductCash.toLocaleString()),1)]),_:1})]),_:1})]),_:1}),t(a(f),null,{default:e(()=>[t(a(d),{class:"kpi-card"},{default:e(()=>[t(a(m),{label:"今日 GGR"},{prefix:e(()=>[...l[12]||(l[12]=[o("$",-1)])]),default:e(()=>[o(" "+r(s.value.ggr.toLocaleString()),1)]),_:1})]),_:1})]),_:1}),t(a(f),null,{default:e(()=>[t(a(d),{class:"kpi-card"},{default:e(()=>[t(a(m),{label:"入金轉換率"},{suffix:e(()=>[...l[13]||(l[13]=[o("%",-1)])]),default:e(()=>[o(" "+r(P.value),1)]),_:1}),t(a(C),{depth:"3",class:"sub-text"},{default:e(()=>[o("人數: "+r(s.value.depositUserCount)+" / "+r(s.value.activeUserCount),1)]),_:1})]),_:1})]),_:1}),t(a(f),null,{default:e(()=>[t(a(d),{class:"kpi-card"},{default:e(()=>[t(a(m),{label:"總派發 (Total Dist)"},{prefix:e(()=>[...l[14]||(l[14]=[o("$",-1)])]),default:e(()=>[o(" "+r(s.value.totalDistribution.toLocaleString()),1)]),_:1}),t(a(C),{depth:"3",class:"sub-text"},{default:e(()=>[o("人工(B): "+r(s.value.manualAddBonus.toLocaleString()),1)]),_:1})]),_:1})]),_:1}),t(a(f),null,{default:e(()=>[t(a(d),{class:"kpi-card"},{default:e(()=>[t(a(m),{label:"活動金轉換率"},{suffix:e(()=>[...l[15]||(l[15]=[o("%",-1)])]),default:e(()=>[o(" "+r(E.value),1)]),_:1}),t(a(C),{depth:"3",class:"sub-text"},{default:e(()=>[o("轉換: $"+r(s.value.totalConversion.toLocaleString()),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(a(I),{"x-gap":"12",cols:3},{default:e(()=>[t(a(f),null,{default:e(()=>[t(a(d),{title:V.value,"content-style":"height: 300px"},{default:e(()=>[R("div",{ref_key:"depositChartRef",ref:h,class:"chart-container"},null,512)]),_:1},8,["title"])]),_:1}),t(a(f),null,{default:e(()=>[t(a(d),{title:W.value,"content-style":"height: 300px"},{default:e(()=>[R("div",{ref_key:"withdrawChartRef",ref:x,class:"chart-container"},null,512)]),_:1},8,["title"])]),_:1}),t(a(f),null,{default:e(()=>[t(a(d),{title:j.value,"content-style":"height: 300px"},{default:e(()=>[R("div",{ref_key:"distributionChartRef",ref:T,class:"chart-container"},null,512)]),_:1},8,["title"])]),_:1})]),_:1})]),_:1})]))}}),ke=se(me,[["__scopeId","data-v-75895753"]]);export{ke as default};
