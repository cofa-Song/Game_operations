import{i as Z,L as ve}from"./index-D5fw03LZ.js";import{P as fe}from"./PulseOutline-CvB9uYtt.js";import{T as ge,F as ye}from"./TimeOutline-ohYVWl4i.js";import{R as he}from"./Refresh-N_ZHlcGf.js";import{e as ae,v as x,w as o,s as M,P as we,o as Se,L as _e,l as ke,E as t,D as s,F as e,G as c,K as U,U as g,Q as N,T as $,J as f,I as F,H,a1 as X,Z as Ie,$ as Ce,r as v,j as Ee,h as q,V as ee,C as be,_ as Me}from"./index-BsKuKuBe.js";import{S as Le}from"./SpeedometerOutline-CKasUOHz.js";import{A as Ae}from"./AlertCircleOutline-CuEJ5tgw.js";import{S as Ne}from"./Scrollbar-F5vu7JFd.js";import{N as E}from"./Icon-CbayTH31.js";import{N as xe}from"./Divider-DILe50Hg.js";import{N as Q}from"./Progress-DbyywU95.js";import{N as _}from"./Tag-I3_cH6qL.js";import{N as Re}from"./DataTable-D5mRR0cm.js";import{N as Te}from"./text-BDsrB_Xz.js";import{N as De,a as Oe}from"./ListItem-Dkrtc_xZ.js";import{N as te}from"./Space-Cf9Hs1lp.js";import{N as Ge}from"./Switch-DXNn_bI_.js";import"./Radio-C5fS5KPL.js";import"./RadioGroup-CgIVku-C.js";import"./Tooltip-XZFA5Owl.js";import"./Popover-CfBNgOAF.js";import"./use-compitable-BjMNwQgq.js";import"./Dropdown-CcmdnIk3.js";import"./create-Bj8PAPmY.js";import"./use-keyboard-kkRvbDTj.js";import"./create-ref-setter-C4J8sofl.js";import"./Select-CCDzjsmj.js";import"./Empty-DtuLCoXR.js";import"./Pagination-BLbp2o8H.js";import"./Forward-CBwL8ab_.js";const Ue={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ze=ae({name:"LinkOutline",render:function(d,u){return M(),x("svg",Ue,u[0]||(u[0]=[o("path",{d:"M208 352h-64a96 96 0 0 1 0-192h64",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36"},null,-1),o("path",{d:"M304 160h64a96 96 0 0 1 0 192h-64",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36"},null,-1),o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36",d:"M163.29 256h187.42"},null,-1)]))}}),D=i=>new Promise(d=>setTimeout(d,i));let b=[{id:"PAY_01",name:"GreenPay (綠界)",group:"PAYMENT",status:"ALIVE",latency:45,lastCheck:new Date().toISOString()},{id:"PAY_02",name:"USDT-TRC20",group:"PAYMENT",status:"ALIVE",latency:120,lastCheck:new Date().toISOString()},{id:"GAME_01",name:"Evolution Gaming",group:"GAME",status:"ALIVE",latency:85,lastCheck:new Date().toISOString()},{id:"GAME_02",name:"PG Soft",group:"GAME",status:"WARNING",latency:1800,lastCheck:new Date().toISOString()},{id:"SYS_01",name:"SMS Gateway",group:"SYSTEM",status:"ALIVE",latency:60,lastCheck:new Date().toISOString()},{id:"SYS_02",name:"Email Service",group:"SYSTEM",status:"ALIVE",latency:110,lastCheck:new Date().toISOString()},{id:"CORE_01",name:"Database (Master)",group:"CORE",status:"ALIVE",latency:5,lastCheck:new Date().toISOString()},{id:"CORE_02",name:"Redis Cache",group:"CORE",status:"ALIVE",latency:2,lastCheck:new Date().toISOString()}];const z={async getHealthStats(){return await D(400),b=b.map(i=>{if(i.status==="ALIVE"||i.status==="WARNING"){const d=Math.floor(Math.random()*50)-25;let u=Math.max(1,i.latency+d);u>1500?i.status="WARNING":u<1e3&&i.status==="WARNING"&&(i.status="ALIVE"),i.latency=u}return i.lastCheck=new Date().toISOString(),i}),{code:0,msg:"success",data:[...b]}},async checkServiceIntegrity(i){await D(600);const d=b.find(u=>u.id===i);return d?(d.lastCheck=new Date().toISOString(),d.latency=Math.floor(Math.random()*100)+20,d.status!=="MAINTENANCE"&&(d.status="ALIVE"),{code:0,msg:"success",data:d}):{code:1,msg:"Service not found",data:null}},async mockServiceFailure(i,d){const u=b.find(k=>k.id===i);return u&&(u.status=d?"CRITICAL":"ALIVE",u.latency=d?9999:50),{code:0,msg:"success",data:null}},async getSystemOverview(){await D(300);const i=45,d=Math.floor(Math.random()*30)-15,u=Math.min(100,Math.max(5,i+d)),k=Math.min(100,Math.max(10,35+Math.floor(Math.random()*40))),p=Math.min(100,Math.max(20,55+Math.floor(Math.random()*25))),r=64,S=Math.round(p/100*r*10)/10,O=Math.min(100,Math.max(30,42+Math.floor(Math.random()*15))),R=Math.floor(b.reduce((L,A)=>L+A.latency,0)/b.length),I=Math.random()>.7?Math.floor(Math.random()*10)+5:Math.floor(Math.random()*5),C=Math.floor(Math.random()*500)+800,y=Math.floor(Math.random()*200)+150;return{code:0,msg:"success",data:{serverLoad:u,cpuUsage:k,memoryUsage:p,memoryUsed:S,memoryTotal:r,diskUsage:O,avgLatency:R,errorCount24h:I,currentQps:C,activeConnections:y,uptime:"15d 7h 42m"}}},async getTrafficTrend(){await D(400);const i=new Date,d=[];for(let u=23;u>=0;u--){const p=new Date(i.getTime()-u*36e5).getHours();let r=5e3;p>=0&&p<6?r=2e3:p>=6&&p<12?r=8e3:p>=12&&p<18?r=12e3:r=18e3;const S=Math.floor(Math.random()*2e3)-1e3;d.push({time:`${String(p).padStart(2,"0")}:00`,requests:Math.max(500,r+S)})}return{code:0,msg:"success",data:d}},async getErrorLogs(){return await D(300),{code:0,msg:"success",data:[{id:"ERR_001",timestamp:new Date(Date.now()-18e5).toISOString(),apiEndpoint:"/api/v1/payment/callback",method:"POST",statusCode:500,message:"Database connection timeout",severity:"CRITICAL",traceId:"trace-abc123"},{id:"ERR_002",timestamp:new Date(Date.now()-36e5).toISOString(),apiEndpoint:"/api/v1/game/session",method:"GET",statusCode:502,message:"Upstream provider unavailable",severity:"ERROR",traceId:"trace-def456"},{id:"ERR_003",timestamp:new Date(Date.now()-72e5).toISOString(),apiEndpoint:"/api/v1/player/balance",method:"GET",statusCode:504,message:"Gateway timeout",severity:"WARNING",traceId:"trace-ghi789"},{id:"ERR_004",timestamp:new Date(Date.now()-108e5).toISOString(),apiEndpoint:"/api/v1/auth/refresh",method:"POST",statusCode:401,message:"Token validation failed",severity:"WARNING",traceId:"trace-jkl012"}]}}},Pe={class:"system-health-container"},Ve={class:"health-header"},Ye={class:"header-left"},je={class:"header-right"},We={class:"uptime-badge"},Be={class:"last-update"},$e={class:"resource-mini"},Fe={class:"resource-mini"},He={class:"res-detail"},qe={class:"resource-mini"},Qe={class:"gauge-mini"},Je={class:"metric-icon-sm bg-blue"},Ke={class:"metric-value-lg"},Ze={class:"metric-icon-sm bg-red"},Xe={class:"metric-value-lg error-value"},et={class:"metric-icon-sm bg-green"},tt={class:"metric-value-lg"},at={class:"sub-metric"},st={class:"group-header-compact"},lt={class:"service-left"},ot={class:"service-name"},rt={class:"service-right"},nt=6e4,it=ae({__name:"SystemStatus",setup(i){const d=we(),u=v(!1),k=v(""),p=v([]),r=v({serverLoad:0,cpuUsage:0,memoryUsage:0,memoryUsed:0,memoryTotal:64,diskUsage:0,avgLatency:0,errorCount24h:0,currentQps:0,activeConnections:0,uptime:"0d 0h 0m"}),S=v([]),O=v([]),R=v(!1),I=v(!1),C=v(""),y=v({}),L=v({}),A=Ee(()=>Object.entries(y.value).filter(([l,a])=>L.value[l]!==a).map(([l,a])=>({id:l,enabled:a}))),se=l=>y.value[l]??!0,le=(l,a)=>{y.value[l]=a},oe=l=>{var a;return((a=p.value.find(n=>n.id===l))==null?void 0:a.name)||l},re=()=>{y.value={...L.value},I.value=!1,C.value=""},ne=()=>{d.success(`已變更 ${A.value.length} 項服務狀態`),L.value={...y.value},I.value=!1,C.value=""};let P=null;const V=v(null),Y=v(null);let h=null,w=null;const ie=[{key:"PAYMENT",label:"金流供應商"},{key:"GAME",label:"遊戲供應商"},{key:"SYSTEM",label:"系統服務"},{key:"CORE",label:"核心設施"}],de=[{title:"時間",key:"timestamp",width:160,render:l=>new Date(l.timestamp).toLocaleString()},{title:"API",key:"apiEndpoint",ellipsis:{tooltip:!0}},{title:"Method",key:"method",width:70,render:l=>q(_,{size:"tiny",type:"info"},{default:()=>l.method})},{title:"Status",key:"statusCode",width:70,render:l=>q(_,{size:"tiny",type:"error"},{default:()=>l.statusCode})},{title:"訊息",key:"message",ellipsis:{tooltip:!0}},{title:"嚴重度",key:"severity",width:90,render:l=>q(_,{size:"small",type:l.severity==="CRITICAL"?"error":l.severity==="ERROR"?"warning":"default"},{default:()=>l.severity})}],G=l=>p.value.filter(a=>a.group===l),ue=l=>{const a=G(l),n=a.filter(m=>m.status==="ALIVE").length;return n===a.length?"success":n>0?"warning":"error"},ce=l=>({ALIVE:"dot-green",WARNING:"dot-yellow",CRITICAL:"dot-red"})[l]||"dot-gray",me=l=>l<200?"latency-good":l<1e3?"latency-warn":"latency-bad",j=l=>l<50?"success":l<80?"warning":"error",pe=()=>{V.value&&(h=Z(V.value)),Y.value&&(w=Z(Y.value)),J()},J=()=>{if(h){const l=r.value.serverLoad;h.setOption({series:[{type:"gauge",startAngle:180,endAngle:0,min:0,max:100,itemStyle:{color:l<50?"#18a058":l<80?"#f0a020":"#d03050"},progress:{show:!0,width:10},pointer:{show:!1},axisLine:{lineStyle:{width:10,color:[[1,"#e5e7eb"]]}},axisTick:{show:!1},splitLine:{show:!1},axisLabel:{show:!1},title:{show:!1},detail:{valueAnimation:!0,fontSize:18,fontWeight:"bold",offsetCenter:[0,"0%"],formatter:"{value}%",color:l<50?"#18a058":l<80?"#f0a020":"#d03050"},data:[{value:l}]}]})}w&&S.value.length>0&&w.setOption({tooltip:{trigger:"axis"},grid:{left:"2%",right:"3%",top:"10%",bottom:"10%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:S.value.map(l=>l.time),axisLabel:{color:"#94a3b8"}},yAxis:{type:"value",axisLabel:{color:"#94a3b8"},splitLine:{lineStyle:{color:"#f1f5f9"}}},series:[{name:"Requests",type:"line",smooth:!0,symbol:"none",itemStyle:{color:"#3b82f6"},lineStyle:{width:2},areaStyle:{color:new ve(0,0,0,1,[{offset:0,color:"rgba(59, 130, 246, 0.25)"},{offset:1,color:"rgba(59, 130, 246, 0.02)"}])},data:S.value.map(l=>l.requests)}]})},W=async(l=!1)=>{l&&(u.value=!0);try{const[a,n,m,T]=await Promise.all([z.getHealthStats(),z.getSystemOverview(),z.getTrafficTrend(),z.getErrorLogs()]);a.code===0&&a.data&&(p.value=a.data,a.data.forEach(B=>{B.id in y.value||(y.value[B.id]=!0,L.value[B.id]=!0)})),n.code===0&&n.data&&(r.value=n.data),m.code===0&&m.data&&(S.value=m.data),T.code===0&&T.data&&(O.value=T.data),k.value=new Date().toLocaleTimeString(),J()}catch{d.error("監控數據更新失敗")}finally{l&&(u.value=!1)}},K=()=>{h==null||h.resize(),w==null||w.resize()};return Se(()=>{W(!0),_e(()=>{pe(),window.addEventListener("resize",K)}),P=window.setInterval(()=>W(!1),nt)}),ke(()=>{P&&clearInterval(P),window.removeEventListener("resize",K),h==null||h.dispose(),w==null||w.dispose()}),(l,a)=>(M(),x("div",Pe,[o("div",Ve,[o("div",Ye,[t(e(E),{size:"28",color:"#3b82f6"},{default:s(()=>[t(e(fe))]),_:1}),a[6]||(a[6]=o("div",null,[o("h1",null,"系統健康監測"),o("p",{class:"subtitle"},"System Health Monitoring Dashboard")],-1))]),o("div",je,[o("div",We,[t(e(E),null,{default:s(()=>[t(e(ge))]),_:1}),o("span",null,"運行時間: "+c(r.value.uptime),1)]),t(e(xe),{vertical:""}),o("span",Be,"最後更新: "+c(k.value),1),t(e(U),{type:"primary",secondary:"",circle:"",loading:u.value,onClick:a[0]||(a[0]=n=>W(!0))},{icon:s(()=>[t(e(E),null,{default:s(()=>[t(e(he))]),_:1})]),_:1},8,["loading"])])]),t(e($),{"x-gap":"16","y-gap":"16",cols:12},{default:s(()=>[t(e(g),{span:5},{default:s(()=>[t(e(N),{class:"section-card",title:"伺服器資源 (Server Resources)"},{"header-extra":s(()=>[t(e(_),{type:r.value.serverLoad<50?"success":r.value.serverLoad<80?"warning":"error",round:"",size:"small"},{default:s(()=>[f(" 負載 "+c(r.value.serverLoad)+"% ",1)]),_:1},8,["type"])]),default:s(()=>[t(e($),{"x-gap":"16",cols:4},{default:s(()=>[t(e(g),null,{default:s(()=>[o("div",$e,[a[7]||(a[7]=o("span",{class:"res-label"},"CPU",-1)),t(e(Q),{type:"circle",percentage:r.value.cpuUsage,status:j(r.value.cpuUsage),"stroke-width":8,style:{width:"60px"}},null,8,["percentage","status"])])]),_:1}),t(e(g),null,{default:s(()=>[o("div",Fe,[a[8]||(a[8]=o("span",{class:"res-label"},"Memory",-1)),t(e(Q),{type:"circle",percentage:r.value.memoryUsage,status:j(r.value.memoryUsage),"stroke-width":8,style:{width:"60px"}},null,8,["percentage","status"]),o("span",He,c(r.value.memoryUsed)+"/"+c(r.value.memoryTotal)+"G",1)])]),_:1}),t(e(g),null,{default:s(()=>[o("div",qe,[a[9]||(a[9]=o("span",{class:"res-label"},"Disk",-1)),t(e(Q),{type:"circle",percentage:r.value.diskUsage,status:j(r.value.diskUsage),"stroke-width":8,style:{width:"60px"}},null,8,["percentage","status"])])]),_:1}),t(e(g),null,{default:s(()=>[o("div",Qe,[o("div",{ref_key:"gaugeChartRef",ref:V,style:{height:"80px",width:"100%"}},null,512)])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(g),{span:2},{default:s(()=>[t(e(N),{class:"section-card metric-card-sm"},{default:s(()=>[o("div",Je,[t(e(E),{size:"20"},{default:s(()=>[t(e(Le))]),_:1})]),a[11]||(a[11]=o("div",{class:"metric-label"},"API 平均延遲",-1)),o("div",Ke,[f(c(r.value.avgLatency),1),a[10]||(a[10]=o("small",null,"ms",-1))]),t(e(_),{size:"tiny",type:r.value.avgLatency<200?"success":r.value.avgLatency<500?"warning":"error"},{default:s(()=>[f(c(r.value.avgLatency<200?"正常":r.value.avgLatency<500?"稍慢":"過慢"),1)]),_:1},8,["type"])]),_:1})]),_:1}),t(e(g),{span:2},{default:s(()=>[t(e(N),{class:"section-card metric-card-sm clickable",onClick:a[1]||(a[1]=n=>R.value=!0)},{default:s(()=>[o("div",Ze,[t(e(E),{size:"20"},{default:s(()=>[t(e(Ae))]),_:1})]),a[12]||(a[12]=o("div",{class:"metric-label"},"系統錯誤 (24h)",-1)),o("div",Xe,c(r.value.errorCount24h),1),t(e(_),{size:"tiny",type:r.value.errorCount24h===0?"success":r.value.errorCount24h<5?"warning":"error"},{default:s(()=>[f(c(r.value.errorCount24h===0?"無異常":"點擊查看"),1)]),_:1},8,["type"])]),_:1})]),_:1}),t(e(g),{span:3},{default:s(()=>[t(e(N),{class:"section-card metric-card-sm"},{default:s(()=>[o("div",et,[t(e(E),{size:"20"},{default:s(()=>[t(e(ye))]),_:1})]),a[14]||(a[14]=o("div",{class:"metric-label"},"即時 QPS",-1)),o("div",tt,[f(c(r.value.currentQps),1),a[13]||(a[13]=o("small",null,"/s",-1))]),o("div",at,[t(e(E),{size:"12"},{default:s(()=>[t(e(ze))]),_:1}),o("span",null,c(r.value.activeConnections)+" 連線",1)])]),_:1})]),_:1})]),_:1}),t(e($),{"x-gap":"16","y-gap":"16",cols:12,style:{"margin-top":"16px"}},{default:s(()=>[t(e(g),{span:7},{default:s(()=>[t(e(N),{class:"section-card",title:"API 流量走勢 (過去24小時)"},{default:s(()=>[o("div",{ref_key:"trendChartRef",ref:Y,style:{height:"360px"}},null,512)]),_:1})]),_:1}),t(e(g),{span:5},{default:s(()=>[t(e(N),{class:"section-card",title:"服務健康狀態 (Service Health)"},{"header-extra":s(()=>[t(e(U),{type:"primary",size:"small",disabled:A.value.length===0,onClick:a[2]||(a[2]=n=>I.value=!0)},{default:s(()=>[f(" 存取操作 ("+c(A.value.length)+") ",1)]),_:1},8,["disabled"])]),default:s(()=>[t(e(Ne),{style:{"max-height":"360px"}},{default:s(()=>[(M(),x(F,null,H(ie,n=>o("div",{key:n.key,class:"service-group-compact"},[o("div",st,[o("span",null,c(n.label),1),t(e(_),{size:"tiny",type:ue(n.key)},{default:s(()=>[f(c(G(n.key).filter(m=>m.status==="ALIVE").length)+"/"+c(G(n.key).length),1)]),_:2},1032,["type"])]),(M(!0),x(F,null,H(G(n.key),m=>(M(),x("div",{key:m.id,class:"service-row"},[o("div",lt,[o("div",{class:ee(["status-dot",ce(m.status)])},null,2),o("span",ot,c(m.name),1)]),o("div",rt,[o("span",{class:ee(["latency",me(m.latency)])},c(m.latency)+"ms",3),t(e(Ge),{value:se(m.id),size:"small","onUpdate:value":T=>le(m.id,T)},null,8,["value","onUpdate:value"])])]))),128))])),64))]),_:1})]),_:1})]),_:1})]),_:1}),t(e(X),{show:R.value,"onUpdate:show":a[3]||(a[3]=n=>R.value=n),preset:"card",title:"系統錯誤紀錄 (Error Logs)",style:{width:"900px"}},{default:s(()=>[t(e(Re),{columns:de,data:O.value,bordered:!1,size:"small"},null,8,["data"])]),_:1},8,["show"]),t(e(X),{show:I.value,"onUpdate:show":a[5]||(a[5]=n=>I.value=n),preset:"card",title:"存取操作確認",style:{width:"500px"}},{footer:s(()=>[t(e(te),{justify:"end"},{default:s(()=>[t(e(U),{onClick:re},{default:s(()=>[...a[16]||(a[16]=[f("取消",-1)])]),_:1}),t(e(U),{type:"primary",disabled:!C.value,onClick:ne},{default:s(()=>[...a[17]||(a[17]=[f("確認變更",-1)])]),_:1},8,["disabled"])]),_:1})]),default:s(()=>[t(e(Te),null,{default:s(()=>[...a[15]||(a[15]=[f("即將變更以下服務狀態：",-1)])]),_:1}),t(e(De),{bordered:"",style:{margin:"16px 0"}},{default:s(()=>[(M(!0),x(F,null,H(A.value,n=>(M(),be(e(Oe),{key:n.id},{default:s(()=>[t(e(te),{justify:"space-between",align:"center",style:{width:"100%"}},{default:s(()=>[o("span",null,c(oe(n.id)),1),t(e(_),{type:n.enabled?"success":"error",size:"small"},{default:s(()=>[f(c(n.enabled?"開啟":"關閉"),1)]),_:2},1032,["type"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(e(Ie),{label:"變更原因",required:""},{default:s(()=>[t(e(Ce),{value:C.value,"onUpdate:value":a[4]||(a[4]=n=>C.value=n),type:"textarea",placeholder:"請輸入變更原因...",rows:2},null,8,["value"])]),_:1})]),_:1},8,["show"])]))}}),Pt=Me(it,[["__scopeId","data-v-539fdf12"]]);export{Pt as default};
