import{e as oe,A as ie,P as ne,h as u,K as N,o as se,v as I,E as o,D as n,F as e,Y as P,aN as re,T as de,U as b,Z as d,$ as F,w as E,J as w,G as m,Q as j,W as K,a8 as ue,S as A,a1 as Z,r as p,a0 as H,j as S,s as M}from"./index-BsKuKuBe.js";import{a as B}from"./game-xj33TST8.js";import{p as me}from"./provider-B_TH2Ac7.js";import{c as pe}from"./config-DZ_tPtnd.js";import{C as W}from"./CreateOutline-CbXbgX50.js";import{S as ve}from"./SearchOutline-tjJoWZeT.js";import{R as ce}from"./RefreshOutline-DGpX8rVm.js";import{N as J}from"./Tag-I3_cH6qL.js";import{N as Q}from"./Switch-DXNn_bI_.js";import{N as O}from"./Select-CCDzjsmj.js";import{N as ge}from"./DatePicker-CVYfnur-.js";import{N as fe}from"./DataTable-D5mRR0cm.js";import{N as D}from"./InputNumber-BMu_ZOnr.js";import"./Popover-CfBNgOAF.js";import"./use-compitable-BjMNwQgq.js";import"./create-Bj8PAPmY.js";import"./Empty-DtuLCoXR.js";import"./use-keyboard-kkRvbDTj.js";import"./Forward-CBwL8ab_.js";import"./Radio-C5fS5KPL.js";import"./RadioGroup-CgIVku-C.js";import"./Tooltip-XZFA5Owl.js";import"./Dropdown-CcmdnIk3.js";import"./Icon-CbayTH31.js";import"./create-ref-setter-C4J8sofl.js";import"./Pagination-BLbp2o8H.js";import"./Add-BJRbFrfV.js";const _e={class:"p-6"},be={class:"flex justify-end gap-2 h-full items-start pt-1"},ye={class:"mb-4 flex gap-2"},he={key:0,class:"ml-1"},we={key:0,class:"mb-4 p-3 bg-gray-50 rounded"},ke={class:"font-semibold"},Ne={class:"text-xs text-gray-500"},xe={class:"flex justify-end gap-2"},Xe=oe({__name:"GameList",setup(Ee){const{t}=ie(),c=ne(),g=p(!1),L=p([]),T=p([]),U=p([]),s=H({provider_id:void 0,type_id:void 0,marketing_tag:void 0,tag_source:void 0,game_id:"",name:"",status:void 0,date_start:void 0,date_end:void 0,page:1,page_size:20}),y=p(null),f=p({}),V=S(()=>Object.keys(f.value).length>0),C=p(!1),k=H({page:1,pageSize:20,itemCount:0,showSizePicker:!0,pageSizes:[10,20,50],onChange:a=>{k.page=a,s.page=a,h()},onUpdatePageSize:a=>{k.pageSize=a,k.page=1,s.page_size=a,s.page=1,h()}}),x=p(!1),_=p(null),r=p({marketing_tag:void 0,allowed_currencies:[],min_vip_level:0,sort_order:999,final_rate:100,profit_rate:5}),G=S(()=>[{label:t("game.list.tagOptions.none"),value:null},{label:t("game.list.tagOptions.hot"),value:"HOT"},{label:t("game.list.tagOptions.recommended"),value:"RECOMMENDED"},{label:t("game.list.tagOptions.double"),value:"DOUBLE_TURNOVER"}]),Y=S(()=>T.value.map(a=>({label:`${a.name} (${a.code})`,value:a.id}))),q=[{label:t("common.all"),value:void 0},{label:t("common.enable"),value:"ACTIVE"},{label:t("common.disable"),value:"DISABLED"},{label:t("game.list.maintenance"),value:"MAINTENANCE"}],X=S(()=>[{label:t("common.all"),value:void 0},...U.value.map(a=>({label:a.name,value:a.id}))]),ee=[{title:"ID",key:"id",width:80,fixed:"left"},{title:t("game.list.vendor"),key:"provider_id",width:100,render:a=>{const l=T.value.find(i=>i.id===a.provider_id);return l?l.code:a.provider_id}},{title:t("game.list.gameName"),key:"name",width:150,ellipsis:{tooltip:!0}},{title:t("game.list.winRate"),key:"win_rate",width:100,render:a=>{if(a.total_bet===0)return"0.00%";const l=(a.total_bet-a.total_payout)/a.total_bet*100,i=l>=0?"text-green-600":"text-red-600";return u("span",{class:`font-mono font-bold ${i}`},`${l.toFixed(2)}%`)}},{title:t("game.list.cumulativeTurnover"),key:"cumulative_turnover",width:120,render:a=>u("span",{class:"font-mono text-blue-600 font-semibold"},a.cumulative_turnover.toLocaleString())},{title:t("game.list.tag"),key:"marketing_tag",width:140,render:a=>{if(!a.marketing_tag)return"-";const i={HOT:{label:t("game.list.tagOptions.hot").split(" ")[0],type:"error"},RECOMMENDED:{label:t("game.list.tagOptions.recommended").split(" ")[0],type:"warning"},DOUBLE_TURNOVER:{label:t("game.list.tagOptions.double").split(" ")[0],type:"success"}}[a.marketing_tag];return u(J,{type:i.type,size:"small"},{default:()=>i.label})}},{title:t("game.list.effectiveTurnoverRate"),key:"final_rate",width:120,render:a=>u("span",{class:a.final_rate>100?"text-green-600 font-bold":"font-mono"},`${a.final_rate}%`)},{title:t("game.list.setProfitRate"),key:"profit_rate",width:100,render:a=>u("span",{class:"text-purple-600 font-mono font-bold"},`${a.profit_rate.toFixed(2)}%`)},{title:t("game.list.enable"),key:"is_enabled",width:100,render:a=>{const i=(f.value[a.id]||a.status)!=="DISABLED";return u(Q,{value:i,onUpdateValue:v=>{z(a,v?"ACTIVE":"DISABLED")}})}},{title:t("game.list.maintenance"),key:"is_maintenance",width:100,render:a=>{const l=f.value[a.id]||a.status;return u(Q,{value:l==="MAINTENANCE",disabled:!(l!=="DISABLED"),onUpdateValue:R=>{z(a,R?"MAINTENANCE":"ACTIVE")}})}},{title:t("game.list.currency"),key:"allowed_currencies",width:120,render:a=>{const l={GOLD:t("common.gold"),SILVER:t("common.silver"),BRONZE:t("common.bronze")};return a.allowed_currencies.map(i=>l[i]||i).join(", ")}},{title:t("game.list.vip"),key:"min_vip_level",width:60},{title:t("game.provider.sortOrder"),key:"sort_order",width:70},{title:t("game.list.typeTag"),key:"type_id",width:120,render:a=>{const l=U.value.find(i=>i.id===a.type_id);return u(J,{size:"small",type:"info",bordered:!1},{default:()=>l?l.name:a.type_id})}},{title:t("common.action"),key:"actions",width:80,fixed:"right",render:a=>u(N,{size:"small",secondary:!0,onClick:()=>te(a)},{icon:()=>u(W)})}],h=async()=>{g.value=!0,f.value={},y.value?(s.date_start=new Date(y.value[0]).toISOString(),s.date_end=new Date(y.value[1]).toISOString()):(s.date_start=void 0,s.date_end=void 0);try{const a=await B.getGames(s);a.code===0?(L.value=a.data.list,k.itemCount=a.data.total):c.error(a.msg)}catch{c.error(t("common.error"))}finally{g.value=!1}};se(async()=>{const a=new Date,l=new Date(a.getTime()-7*24*60*60*1e3);y.value=[l.getTime(),a.getTime()];const[i,v]=await Promise.all([me.getProviders(),pe.getGameTypes()]);i.code===0&&(T.value=i.data),v.code===0&&(U.value=v.data),h()});const z=(a,l)=>{a.status===l?delete f.value[a.id]:f.value[a.id]=l},ae=async()=>{g.value=!0;try{const a=Object.entries(f.value).map(([v,R])=>B.updateGame(v,{status:R})),l=await Promise.all(a),i=l.filter(v=>v.code===0).length;i===l.length?c.success(t("common.success")):c.warning(`部分存取失敗 (${i}/${l.length})`),C.value=!1,h()}catch{c.error(t("common.error"))}finally{g.value=!1}},$=()=>{s.page=1,k.page=1,h()},te=a=>{_.value=a,r.value={marketing_tag:a.marketing_tag,allowed_currencies:a.allowed_currencies,min_vip_level:a.min_vip_level,sort_order:a.sort_order,final_rate:a.final_rate,profit_rate:a.profit_rate},x.value=!0},le=async()=>{if(_.value)try{const a=await B.updateGame(_.value.id,r.value);a.code===0?(c.success(t("common.success")),x.value=!1,h()):c.error(a.msg)}catch{c.error(t("common.error"))}};return(a,l)=>(M(),I("div",_e,[o(e(j),{title:e(t)("game.list.title"),class:"mb-4"},{default:n(()=>[o(e(P),{model:s,"label-placement":"left","label-width":"auto",onKeypress:re($,["enter"])},{default:n(()=>[o(e(de),{cols:24,"x-gap":12},{default:n(()=>[o(e(b),{span:6},{default:n(()=>[o(e(d),{label:e(t)("game.list.vendor")},{default:n(()=>[o(e(O),{value:s.provider_id,"onUpdate:value":l[0]||(l[0]=i=>s.provider_id=i),options:Y.value,placeholder:e(t)("common.all"),clearable:""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),o(e(b),{span:6},{default:n(()=>[o(e(d),{label:e(t)("game.list.gameId")},{default:n(()=>[o(e(F),{value:s.game_id,"onUpdate:value":l[1]||(l[1]=i=>s.game_id=i),placeholder:e(t)("common.search"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(e(b),{span:6},{default:n(()=>[o(e(d),{label:e(t)("game.list.gameName")},{default:n(()=>[o(e(F),{value:s.name,"onUpdate:value":l[2]||(l[2]=i=>s.name=i),placeholder:e(t)("common.search"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(e(b),{span:6},{default:n(()=>[o(e(d),{label:e(t)("game.list.tag")},{default:n(()=>[o(e(O),{value:s.marketing_tag,"onUpdate:value":l[3]||(l[3]=i=>s.marketing_tag=i),options:G.value,placeholder:e(t)("common.all"),clearable:""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),o(e(b),{span:6},{default:n(()=>[o(e(d),{label:e(t)("game.list.typeTag")},{default:n(()=>[o(e(O),{value:s.type_id,"onUpdate:value":l[4]||(l[4]=i=>s.type_id=i),options:X.value,placeholder:e(t)("common.all"),clearable:""},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1}),o(e(b),{span:6},{default:n(()=>[o(e(d),{label:e(t)("common.status")},{default:n(()=>[o(e(O),{value:s.status,"onUpdate:value":l[5]||(l[5]=i=>s.status=i),options:q,placeholder:e(t)("common.all"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(e(b),{span:8},{default:n(()=>[o(e(d),{label:e(t)("game.list.dateRange")},{default:n(()=>[o(e(ge),{value:y.value,"onUpdate:value":l[6]||(l[6]=i=>y.value=i),type:"datetimerange",clearable:""},null,8,["value"])]),_:1},8,["label"])]),_:1}),o(e(b),{span:4},{default:n(()=>[E("div",be,[o(e(N),{type:"primary",onClick:$,loading:g.value},{icon:n(()=>[o(e(ve))]),default:n(()=>[w(" "+m(e(t)("common.search")),1)]),_:1},8,["loading"]),o(e(N),{secondary:"",onClick:l[7]||(l[7]=()=>{y.value=null,h()}),loading:g.value},{icon:n(()=>[o(e(ce))]),default:n(()=>[w(" "+m(e(t)("common.all")),1)]),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"]),o(e(j),null,{default:n(()=>[E("div",ye,[o(e(N),{type:"warning",disabled:!V.value,onClick:l[8]||(l[8]=i=>C.value=!0),loading:g.value},{icon:n(()=>[o(e(W))]),default:n(()=>[w(" "+m(e(t)("game.list.accessOperation"))+" ",1),V.value?(M(),I("span",he,"("+m(Object.keys(f.value).length)+")",1)):K("",!0)]),_:1},8,["disabled","loading"])]),o(e(fe),{columns:ee,data:L.value,loading:g.value,pagination:k,"scroll-x":1600},null,8,["data","loading","pagination"])]),_:1}),o(e(Z),{show:x.value,"onUpdate:show":l[16]||(l[16]=i=>x.value=i),preset:"card",title:e(t)("game.list.editTitle"),style:{width:"500px"}},{footer:n(()=>[E("div",xe,[o(e(N),{onClick:l[15]||(l[15]=i=>x.value=!1)},{default:n(()=>[w(m(e(t)("common.cancel")),1)]),_:1}),o(e(N),{type:"primary",onClick:le},{default:n(()=>[w(m(e(t)("common.save")),1)]),_:1})])]),default:n(()=>[_.value?(M(),I("div",we,[E("div",ke,m(_.value.name)+" ("+m(_.value.name_en)+")",1),E("div",Ne,m(_.value.id)+" | "+m(_.value.provider_id),1)])):K("",!0),o(e(P),{model:r.value,"label-placement":"left","label-width":"100"},{default:n(()=>[o(e(d),{label:e(t)("game.list.tag")},{default:n(()=>[o(e(O),{value:r.value.marketing_tag,"onUpdate:value":l[9]||(l[9]=i=>r.value.marketing_tag=i),options:G.value},null,8,["value","options"])]),_:1},8,["label"]),o(e(d),{label:e(t)("game.list.currency")},{default:n(()=>[o(e(ue),{value:r.value.allowed_currencies,"onUpdate:value":l[10]||(l[10]=i=>r.value.allowed_currencies=i)},{default:n(()=>[o(e(A),{value:"GOLD",label:e(t)("common.gold")},null,8,["label"]),o(e(A),{value:"SILVER",label:e(t)("common.silver")},null,8,["label"]),o(e(A),{value:"BRONZE",label:e(t)("common.bronze")},null,8,["label"])]),_:1},8,["value"])]),_:1},8,["label"]),o(e(d),{label:e(t)("game.list.vip")},{default:n(()=>[o(e(D),{value:r.value.min_vip_level,"onUpdate:value":l[11]||(l[11]=i=>r.value.min_vip_level=i),min:0,max:10,style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"]),o(e(d),{label:e(t)("game.list.effectiveTurnoverRate")},{default:n(()=>[o(e(D),{value:r.value.final_rate,"onUpdate:value":l[12]||(l[12]=i=>r.value.final_rate=i),min:0,max:1e3,style:{width:"100%"}},{suffix:n(()=>[...l[18]||(l[18]=[w("%",-1)])]),_:1},8,["value"])]),_:1},8,["label"]),o(e(d),{label:e(t)("game.list.profitRate")},{default:n(()=>[o(e(D),{value:r.value.profit_rate,"onUpdate:value":l[13]||(l[13]=i=>r.value.profit_rate=i),min:0,max:100,style:{width:"100%"}},{suffix:n(()=>[...l[19]||(l[19]=[w("%",-1)])]),_:1},8,["value"])]),_:1},8,["label"]),o(e(d),{label:e(t)("game.provider.sortOrder")},{default:n(()=>[o(e(D),{value:r.value.sort_order,"onUpdate:value":l[14]||(l[14]=i=>r.value.sort_order=i),min:1,max:999,style:{width:"100%"}},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["show","title"]),o(e(Z),{show:C.value,"onUpdate:show":l[17]||(l[17]=i=>C.value=i),preset:"dialog",type:"warning",title:e(t)("common.warning"),content:e(t)("game.list.saveConfirm"),"positive-text":e(t)("common.confirm"),"negative-text":e(t)("common.cancel"),onPositiveClick:ae},null,8,["show","title","content","positive-text","negative-text"])]))}});export{Xe as default};
