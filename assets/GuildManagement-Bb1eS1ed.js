import{e as te,P as ae,o as le,v as ne,E as a,D as o,F as l,Q as G,Y as U,Z as p,K as f,J as N,$ as x,a1 as O,r as u,a0 as S,h as r,s as ie,_ as oe}from"./index-BsKuKuBe.js";import{S as se}from"./SearchOutline-tjJoWZeT.js";import{P as re}from"./PeopleOutline-CQmmVffL.js";import{u as de}from"./composables-FnfCle_S.js";import{N as ue}from"./Spin-D6NC1_9t.js";import{N as I}from"./InputNumber-BMu_ZOnr.js";import{N as L}from"./Space-Cf9Hs1lp.js";import{N as A}from"./Icon-CbayTH31.js";import{N as B}from"./DataTable-D5mRR0cm.js";import{N as j}from"./text-BDsrB_Xz.js";import{N as $}from"./Tag-I3_cH6qL.js";import"./use-compitable-BjMNwQgq.js";import"./Add-BJRbFrfV.js";import"./Radio-C5fS5KPL.js";import"./RadioGroup-CgIVku-C.js";import"./Tooltip-XZFA5Owl.js";import"./Popover-CfBNgOAF.js";import"./Dropdown-CcmdnIk3.js";import"./create-Bj8PAPmY.js";import"./use-keyboard-kkRvbDTj.js";import"./create-ref-setter-C4J8sofl.js";import"./Select-CCDzjsmj.js";import"./Empty-DtuLCoXR.js";import"./Pagination-BLbp2o8H.js";import"./Forward-CBwL8ab_.js";const F={creation_cost:1e3,creation_level_threshold:5,fee_reduction_percentage:2},_=[{id:"G001",name:"星際第一軍團",leader_id:"P9901",member_count:156,total_turnover:15688005e-1,level:5,created_at:"2025-10-01T10:00:00Z",status:"NORMAL"},{id:"G002",name:"暗黑騎士團",leader_id:"P8722",member_count:85,total_turnover:987600,level:3,created_at:"2025-11-15T14:30:00Z",status:"NORMAL"},{id:"G003",name:"作弊測試公會",leader_id:"P0001",member_count:5,total_turnover:1200,level:1,created_at:"2026-01-20T09:15:00Z",status:"MUTED"}],g=(i=300)=>new Promise(n=>setTimeout(n,i)),v={async list(i){await g();let n=[..._];i.guild_id_or_name&&(n=n.filter(m=>m.id.includes(i.guild_id_or_name)||m.name.includes(i.guild_id_or_name))),i.leader_id&&(n=n.filter(m=>m.leader_id.includes(i.leader_id)));const d=(i.page-1)*i.pageSize;return{code:0,msg:"success",data:{items:n.slice(d,d+i.pageSize),total:n.length,page:i.page,pageSize:i.pageSize}}},async getGlobalConfig(){return await g(100),{code:0,msg:"success",data:F}},async updateGlobalConfig(i){return await g(),Object.assign(F,i),{code:0,msg:"success"}},async dissolve(i){await g();const n=_.findIndex(d=>d.id===i);return n!==-1&&(_[n].status="DISSOLVED"),{code:0,msg:"success"}},async mute(i){await g();const n=_.findIndex(d=>d.id===i);return n!==-1&&(_[n].status="MUTED"),{code:0,msg:"success"}},async transferLeader(i,n){await g();const d=_.findIndex(y=>y.id===i);return d!==-1&&(_[d].leader_id=n),{code:0,msg:"success"}},async getMembers(i){return await g(500),{code:0,msg:"success",data:[{player_id:"P99001",username:"GuildMaster_X",rank:"LEADER",join_time:"2023-10-01 12:00:00",total_contribution:5e5,last_active:"2024-02-04 15:30:00"},{player_id:"P99002",username:"Elder_Shadow",rank:"ELDER",join_time:"2023-10-05 09:15:00",total_contribution:25e4,last_active:"2024-02-04 14:45:00"},{player_id:"P99003",username:"Warrior_A",rank:"MEMBER",join_time:"2023-11-12 18:20:00",total_contribution:8e4,last_active:"2024-02-03 23:10:00"},{player_id:"P99004",username:"Healer_B",rank:"MEMBER",join_time:"2024-01-02 21:10:00",total_contribution:35e3,last_active:"2024-02-04 10:05:00"}]}}},ce={class:"guild-management"},me=te({__name:"GuildManagement",setup(i){const n=ae(),d=de(),y=u(!1),m=u(!1),c=S({creation_cost:0,creation_level_threshold:0,fee_reduction_percentage:0}),V=async()=>{y.value=!0;try{const e=await v.getGlobalConfig();e.code===0&&Object.assign(c,e.data)}finally{y.value=!1}},Z=async()=>{m.value=!0;try{(await v.updateGlobalConfig({...c})).code===0&&n.success("全域設定更新成功")}finally{m.value=!1}},M=u(!1),T=u([]),b=S({guild_id_or_name:"",leader_id:""}),k=S({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[10,20,50]}),H=[{title:"公會名稱/ID",key:"name",render:e=>r("div",[r("div",{style:"font-weight: bold"},e.name),r(j,{depth:3,size:"small"},{default:()=>e.id})])},{title:"會長 ID",key:"leader_id",render:e=>r(f,{text:!0,type:"primary",onClick:()=>window.open(`/admin/players/${e.leader_id}`)},{default:()=>e.leader_id})},{title:"成員數",key:"member_count"},{title:"總流水",key:"total_turnover",render:e=>e.total_turnover.toLocaleString()},{title:"等級",key:"level"},{title:"狀態",key:"status",render:e=>{const t={NORMAL:"success",DISSOLVED:"error",MUTED:"warning"},s={NORMAL:"正常",DISSOLVED:"已解散",MUTED:"禁言中"};return r($,{type:t[e.status]},{default:()=>s[e.status]})}},{title:"操作",key:"actions",render:e=>r(L,{},{default:()=>[r(f,{size:"small",quaternary:!0,type:"primary",onClick:()=>ee(e)},{icon:()=>r(A,null,{default:()=>r(re)}),default:()=>"成員名單"}),r(f,{size:"small",onClick:()=>Q(e)},{default:()=>"禁言"}),r(f,{size:"small",type:"error",onClick:()=>W(e)},{default:()=>"解散"}),r(f,{size:"small",type:"warning",onClick:()=>X(e)},{default:()=>"轉讓"})]})}],w=async()=>{M.value=!0;try{const e=await v.list({...b,page:k.page,pageSize:k.pageSize});e.code===0&&e.data&&(T.value=e.data.items,k.itemCount=e.data.total)}finally{M.value=!1}},J=()=>{k.page=1,w()},K=e=>{k.page=e,w()},Q=e=>{d.warning({title:"公會禁言",content:`確定要將公會「${e.name}」設為禁言狀態嗎？執行後成員將無法在公會頻道發言。`,positiveText:"確認",negativeText:"取消",onPositiveClick:async()=>{await v.mute(e.id),n.success("公會已禁言"),w()}})},W=e=>{d.error({title:"強制解散公會",content:`確定要解散公會「${e.name}」嗎？此操作不可逆，清空所有成員關係。`,positiveText:"確認解散",negativeText:"再想想",onPositiveClick:async()=>{await v.dissolve(e.id),n.success("公會已強制解散"),w()}})},D=u(!1),z=u(""),h=u(""),X=e=>{z.value=e.id,h.value="",D.value=!0},Y=async()=>h.value?(await v.transferLeader(z.value,h.value),n.success("職位轉讓完成"),w(),!0):(n.warning("請輸入新會長 ID"),!1),E=u(!1),C=u(!1),P=u([]),R=u(""),q=[{title:"玩家 ID",key:"player_id",render:e=>r(f,{text:!0,type:"primary",onClick:()=>window.open(`/admin/players/${e.player_id}`)},{default:()=>e.player_id})},{title:"使用者名稱",key:"username"},{title:"職位",key:"rank",render:e=>{const t={LEADER:"error",ELDER:"warning",MEMBER:"default"},s={LEADER:"會長",ELDER:"長老",MEMBER:"成員"};return r($,{size:"small",type:t[e.rank]},{default:()=>s[e.rank]})}},{title:"累積貢獻",key:"total_contribution",render:e=>e.total_contribution.toLocaleString()},{title:"加入時間",key:"join_time"},{title:"最後在線",key:"last_active"}],ee=async e=>{R.value=e.name,E.value=!0,C.value=!0;try{const t=await v.getMembers(e.id);t.code===0&&t.data&&(P.value=t.data)}finally{C.value=!1}};return le(()=>{V(),w()}),(e,t)=>(ie(),ne("div",ce,[a(l(L),{vertical:"",size:"large"},{default:o(()=>[a(l(G),{title:"公會全域設定"},{default:o(()=>[a(l(ue),{show:y.value},{default:o(()=>[a(l(U),{ref:"configFormRef",model:c,"label-placement":"left","label-width":"120px",inline:""},{default:o(()=>[a(l(p),{label:"創建消耗金額 (Cash)",path:"creation_cost"},{default:o(()=>[a(l(I),{value:c.creation_cost,"onUpdate:value":t[0]||(t[0]=s=>c.creation_cost=s),min:0},null,8,["value"])]),_:1}),a(l(p),{label:"創建等級門檻",path:"creation_level_threshold"},{default:o(()=>[a(l(I),{value:c.creation_level_threshold,"onUpdate:value":t[1]||(t[1]=s=>c.creation_level_threshold=s),min:0},null,8,["value"])]),_:1}),a(l(p),{label:"同公會手續費減免 (%)",path:"fee_reduction_percentage"},{default:o(()=>[a(l(I),{value:c.fee_reduction_percentage,"onUpdate:value":t[2]||(t[2]=s=>c.fee_reduction_percentage=s),min:0,max:100,precision:1},null,8,["value"])]),_:1}),a(l(p),null,{default:o(()=>[a(l(f),{type:"primary",onClick:Z,loading:m.value},{default:o(()=>[...t[8]||(t[8]=[N(" 更新設定 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]),_:1}),a(l(G),{title:"公會清單管理"},{default:o(()=>[a(l(L),{vertical:"",size:"medium"},{default:o(()=>[a(l(U),{inline:"",model:b,"label-placement":"left"},{default:o(()=>[a(l(p),{label:"公會名稱/ID"},{default:o(()=>[a(l(x),{value:b.guild_id_or_name,"onUpdate:value":t[3]||(t[3]=s=>b.guild_id_or_name=s),placeholder:"搜尋公會...",clearable:""},null,8,["value"])]),_:1}),a(l(p),{label:"會長 ID"},{default:o(()=>[a(l(x),{value:b.leader_id,"onUpdate:value":t[4]||(t[4]=s=>b.leader_id=s),placeholder:"搜尋會長...",clearable:""},null,8,["value"])]),_:1}),a(l(p),null,{default:o(()=>[a(l(f),{type:"primary",onClick:J},{icon:o(()=>[a(l(A),null,{default:o(()=>[a(l(se))]),_:1})]),default:o(()=>[t[9]||(t[9]=N(" 搜尋 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),a(l(B),{remote:"",ref:"tableRef",columns:H,data:T.value,loading:M.value,pagination:k,"onUpdate:page":K},null,8,["data","loading","pagination"])]),_:1})]),_:1})]),_:1}),a(l(O),{show:D.value,"onUpdate:show":t[6]||(t[6]=s=>D.value=s),preset:"dialog",title:"會長轉讓","positive-text":"確認轉讓","negative-text":"取消",onPositiveClick:Y},{default:o(()=>[a(l(p),{label:"新會長玩家 ID"},{default:o(()=>[a(l(x),{value:h.value,"onUpdate:value":t[5]||(t[5]=s=>h.value=s),placeholder:"請輸入公會成員 ID"},null,8,["value"])]),_:1}),a(l(j),{depth:"3"},{default:o(()=>[...t[10]||(t[10]=[N(" 轉讓後原會長將降為普通成員，新會長將獲得所有公會管理權限。 ",-1)])]),_:1})]),_:1},8,["show"]),a(l(O),{show:E.value,"onUpdate:show":t[7]||(t[7]=s=>E.value=s),preset:"card",title:`公會成員名單 - ${R.value}`,style:{width:"850px"}},{default:o(()=>[a(l(B),{columns:q,data:P.value,loading:C.value,pagination:{pageSize:10},"max-height":"500px"},null,8,["data","loading"])]),_:1},8,["show","title"])]))}}),Oe=oe(me,[["__scopeId","data-v-44cb9fd8"]]);export{Oe as default};
